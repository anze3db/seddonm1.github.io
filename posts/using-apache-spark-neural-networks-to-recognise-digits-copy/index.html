<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content=True><meta name=MobileOptimized content=320><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=no-referrer><link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400" rel=stylesheet type=text/css><link rel=icon type=image/png href=https://reorchestrate.com/favicon_16x16.png sizes=16x16><link rel=icon type=image/png href=https://reorchestrate.com/favicon_32x32.png sizes=32x32><link rel=icon type=image/png href=https://reorchestrate.com/favicon_128x128.png sizes=128x128><title>Using Apache Spark Neural Networks to Recognise Digits</title><link rel=canonical href=https://reorchestrate.com/posts/using-apache-spark-neural-networks-to-recognise-digits-copy/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;-webkit-font-smoothing:antialiased;line-height:160%;color:#1d1313;max-width:950px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:#0000;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3,h4,h5{font-family:old standard tt,serif}strong{font-weight:600}table{width:100%}thead{font-weight:800;background:#dadada}tbody tr:nth-child(even){background:#f7f7f7}table td,th{padding:2px}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-weight:700;font-size:35px}h2{font-weight:700;font-size:28px}h3{font-weight:700;font-size:22px;margin-top:28px}h4{font-weight:700;font-size:20px;margin-top:20px}h5{font-size:18px;margin-top:18px}h1 a,h2 a,h3 a,h4 a,h5 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,time{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content time{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#source{margin:50px 0 0}#links{margin:50px 0 0}#links :nth-child(2){float:right}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}#nav .sub{font-size:80%;display:inline-block;vertical-align:middle}#nav .sub p{color:#403c3b;margin:0}#nav .sub a{text-decoration:none}#nav .sub svg{fill:#403c3b;display:inline-block;vertical-align:middle;padding-bottom:3px;padding-right:5px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}.chroma{background-color:#f0f0f0}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em}.chroma .ln{margin-right:.4em;padding:0 .4em}.chroma .k{color:#007020;font-weight:700}.chroma .kc{color:#007020;font-weight:700}.chroma .kd{color:#007020;font-weight:700}.chroma .kn{color:#007020;font-weight:700}.chroma .kp{color:#007020}.chroma .kr{color:#007020;font-weight:700}.chroma .kt{color:#902000}.chroma .na{color:#4070a0}.chroma .nb{color:#007020}.chroma .nc{color:#0e84b5;font-weight:700}.chroma .no{color:#60add5}.chroma .nd{color:#555;font-weight:700}.chroma .ni{color:#d55537;font-weight:700}.chroma .ne{color:#007020}.chroma .nf{color:#06287e}.chroma .nl{color:#002070;font-weight:700}.chroma .nn{color:#0e84b5;font-weight:700}.chroma .nt{color:#062873;font-weight:700}.chroma .nv{color:#bb60d5}.chroma .s{color:#4070a0}.chroma .sa{color:#4070a0}.chroma .sb{color:#4070a0}.chroma .sc{color:#4070a0}.chroma .dl{color:#4070a0}.chroma .sd{color:#4070a0;font-style:italic}.chroma .s2{color:#4070a0}.chroma .se{color:#4070a0;font-weight:700}.chroma .sh{color:#4070a0}.chroma .si{color:#70a0d0;font-style:italic}.chroma .sx{color:#c65d09}.chroma .sr{color:#235388}.chroma .s1{color:#4070a0}.chroma .ss{color:#517918}.chroma .m{color:#40a070}.chroma .mb{color:#40a070}.chroma .mf{color:#40a070}.chroma .mh{color:#40a070}.chroma .mi{color:#40a070}.chroma .il{color:#40a070}.chroma .mo{color:#40a070}.chroma .o{color:#666}.chroma .ow{color:#007020;font-weight:700}.chroma .c{color:#60a0b0;font-style:italic}.chroma .ch{color:#60a0b0;font-style:italic}.chroma .cm{color:#60a0b0;font-style:italic}.chroma .c1{color:#60a0b0;font-style:italic}.chroma .cs{color:#60a0b0;background-color:#fff0f0}.chroma .cp{color:#007020}.chroma .cpf{color:#007020}.chroma .gd{color:#a00000}.chroma .ge{font-style:italic}.chroma .gr{color:red}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#888}.chroma .gp{color:#c65d09;font-weight:700}.chroma .gs{font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#04d}.chroma .w{color:#bbb}</style></head><body><section id=nav><h1><a href=https://reorchestrate.com/>reorchestrate</a></h1><section class=section><div class=sub><p>&copy; Mike Seddon 2023 |
<a href=https://www.github.com/seddonm1 target=_blank><svg width="22" height="22" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M896 128q209 0 385.5 103T1561 510.5 1664 896q0 251-146.5 451.5T1139 1625q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 493 446q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128zM419 1231q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"/></svg></a><a href=https://www.linkedin.com/in/mikeseddonau/ target=_blank><svg width="22" height="22" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M365 1414h231V720H365v694zm246-908q-1-52-36-86t-93-34-94.5 34-36.5 86q0 51 35.5 85.5T479 626h1q59 0 95-34.5t36-85.5zm585 908h231v-398q0-154-73-233t-193-79q-136 0-209 117h2V720H723q3 66 0 694h231v-388q0-38 7-56 15-35 45-59.5t74-24.5q116 0 116 157v371zm468-998v960q0 119-84.5 203.5T1376 1664H416q-119 0-203.5-84.5T128 1376V416q0-119 84.5-203.5T416 128h960q119 0 203.5 84.5T1664 416z"/></svg></a></p></div></section><ul></ul></section><section id=content><h1>Using Apache Spark Neural Networks to Recognise Digits</h1><div id=sub-header>12 March 2016</div><div class=entry-content><p>One of the famous machine learning challenges is the performing handwritten character recognition (classification) over the <a href=http://yann.lecun.com/exdb/mnist/>MNIST database of handwritten digits</a>. The MNIST dataset has a training set of 60,000 and a test set of 10,000 28x28 pixel images of handwritten digits and an integer value between 0 and 9 containing their true value.</p><p>The current best scores are <a href=https://en.wikipedia.org/wiki/MNIST_database>available on Wikipedia</a> with the best score for <a href=https://en.wikipedia.org/wiki/Artificial_neural_network>Neural Networks</a> currently at 0.35% error.</p><p>So let&rsquo;s see how we go using Apache Spark&rsquo;s <a href=https://spark.apache.org/docs/latest/ml-classification-regression.html#multilayer-perceptron-classifier>Multilayer Perceptron Classifier</a>.</p><h3 id=1-0-data-preparation>1.0 Data Preparation</h3><p>Because so many people have used this dataset there are a <a href=http://pjreddie.com/projects/mnist-in-csv/>lot of scripts</a> to convert the raw MNIST data available from <a href=http://yann.lecun.com/exdb/mnist/>http://yann.lecun.com/exdb/mnist/</a> into a more easily ingestible CSV format. I have already taken the CSV representation of the MNIST dataset and converted it to <a href=https://parquet.apache.org/>Parquet</a> (compressed, columnar).</p><h3 id=2-0-a-base-implementation-error-rate-2-90>2.0 A Base Implementation - Error rate: 2.90%</h3><p>Lets start with a minimal implementation. Read the parquet files, <a href=https://spark.apache.org/docs/latest/ml-features.html#vectorindexer>create a vector of the pixels</a>, <a href=https://spark.apache.org/docs/latest/ml-features.html#stringindexer>index the labels</a> and run a MultilayerPerceptronClassifier with two hidden layers of 784 neurons and 800 neurons (based on the Wikipedia MNIST leader board).</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>import</span> <span class=nn>org.apache.spark.ml.</span><span class=o>{</span><span class=nc>Pipeline</span><span class=o>,</span><span class=nc>PipelineModel</span><span class=o>}</span>
<span class=k>import</span> <span class=nn>org.apache.spark.ml.feature.</span><span class=o>{</span><span class=nc>VectorAssembler</span><span class=o>,</span><span class=nc>StringIndexer</span><span class=o>,</span><span class=nc>IndexToString</span><span class=o>}</span>
<span class=k>import</span> <span class=nn>org.apache.spark.ml.classification.</span><span class=o>{</span><span class=nc>MultilayerPerceptronClassifier</span><span class=o>}</span>
<span class=k>import</span> <span class=nn>org.apache.spark.ml.evaluation.</span><span class=o>{</span><span class=nc>MulticlassClassificationEvaluator</span><span class=o>}</span>

<span class=k>val</span> <span class=n>timestampStart</span><span class=k>:</span> <span class=kt>Long</span> <span class=o>=</span> <span class=nc>System</span><span class=o>.</span><span class=n>currentTimeMillis</span>

<span class=k>val</span> <span class=n>train</span> <span class=k>=</span> <span class=n>sqlContext</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>load</span><span class=o>(</span><span class=s>&#34;data/mnist/train.parquet&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>test</span> <span class=k>=</span> <span class=n>sqlContext</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>load</span><span class=o>(</span><span class=s>&#34;data/mnist/test.parquet&#34;</span><span class=o>)</span>

<span class=k>val</span> <span class=n>label</span> <span class=k>=</span> <span class=s>&#34;label&#34;</span>
<span class=k>val</span> <span class=n>labels</span> <span class=k>=</span> <span class=nc>Seq</span><span class=o>(</span><span class=s>&#34;0&#34;</span><span class=o>,</span><span class=s>&#34;1&#34;</span><span class=o>,</span><span class=s>&#34;2&#34;</span><span class=o>,</span><span class=s>&#34;3&#34;</span><span class=o>,</span><span class=s>&#34;4&#34;</span><span class=o>,</span><span class=s>&#34;5&#34;</span><span class=o>,</span><span class=s>&#34;6&#34;</span><span class=o>,</span><span class=s>&#34;7&#34;</span><span class=o>,</span><span class=s>&#34;8&#34;</span><span class=o>,</span><span class=s>&#34;9&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>features</span> <span class=k>=</span> <span class=nc>Array</span><span class=o>(</span><span class=s>&#34;pixel0&#34;</span><span class=o>,</span><span class=s>&#34;pixel1&#34;</span><span class=o>,</span><span class=s>&#34;pixel2&#34;</span><span class=o>,</span><span class=s>&#34;pixel3&#34;</span><span class=o>,</span><span class=s>&#34;pixel4&#34;</span><span class=o>,</span><span class=s>&#34;pixel5&#34;</span><span class=o>,</span><span class=s>&#34;pixel6&#34;</span><span class=o>,</span><span class=s>&#34;pixel7&#34;</span><span class=o>,</span><span class=s>&#34;pixel8&#34;</span><span class=o>,</span><span class=s>&#34;pixel9&#34;</span><span class=o>,</span><span class=s>&#34;pixel10&#34;</span><span class=o>,</span><span class=s>&#34;pixel11&#34;</span><span class=o>,</span><span class=s>&#34;pixel12&#34;</span><span class=o>,</span><span class=s>&#34;pixel13&#34;</span><span class=o>,</span><span class=s>&#34;pixel14&#34;</span><span class=o>,</span><span class=s>&#34;pixel15&#34;</span><span class=o>,</span><span class=s>&#34;pixel16&#34;</span><span class=o>,</span><span class=s>&#34;pixel17&#34;</span><span class=o>,</span><span class=s>&#34;pixel18&#34;</span><span class=o>,</span><span class=s>&#34;pixel19&#34;</span><span class=o>,</span><span class=s>&#34;pixel20&#34;</span><span class=o>,</span><span class=s>&#34;pixel21&#34;</span><span class=o>,</span><span class=s>&#34;pixel22&#34;</span><span class=o>,</span><span class=s>&#34;pixel23&#34;</span><span class=o>,</span><span class=s>&#34;pixel24&#34;</span><span class=o>,</span><span class=s>&#34;pixel25&#34;</span><span class=o>,</span><span class=s>&#34;pixel26&#34;</span><span class=o>,</span><span class=s>&#34;pixel27&#34;</span><span class=o>,</span><span class=s>&#34;pixel28&#34;</span><span class=o>,</span><span class=s>&#34;pixel29&#34;</span><span class=o>,</span><span class=s>&#34;pixel30&#34;</span><span class=o>,</span><span class=s>&#34;pixel31&#34;</span><span class=o>,</span><span class=s>&#34;pixel32&#34;</span><span class=o>,</span><span class=s>&#34;pixel33&#34;</span><span class=o>,</span><span class=s>&#34;pixel34&#34;</span><span class=o>,</span><span class=s>&#34;pixel35&#34;</span><span class=o>,</span><span class=s>&#34;pixel36&#34;</span><span class=o>,</span><span class=s>&#34;pixel37&#34;</span><span class=o>,</span><span class=s>&#34;pixel38&#34;</span><span class=o>,</span><span class=s>&#34;pixel39&#34;</span><span class=o>,</span><span class=s>&#34;pixel40&#34;</span><span class=o>,</span><span class=s>&#34;pixel41&#34;</span><span class=o>,</span><span class=s>&#34;pixel42&#34;</span><span class=o>,</span><span class=s>&#34;pixel43&#34;</span><span class=o>,</span><span class=s>&#34;pixel44&#34;</span><span class=o>,</span><span class=s>&#34;pixel45&#34;</span><span class=o>,</span><span class=s>&#34;pixel46&#34;</span><span class=o>,</span><span class=s>&#34;pixel47&#34;</span><span class=o>,</span><span class=s>&#34;pixel48&#34;</span><span class=o>,</span><span class=s>&#34;pixel49&#34;</span><span class=o>,</span><span class=s>&#34;pixel50&#34;</span><span class=o>,</span><span class=s>&#34;pixel51&#34;</span><span class=o>,</span><span class=s>&#34;pixel52&#34;</span><span class=o>,</span><span class=s>&#34;pixel53&#34;</span><span class=o>,</span><span class=s>&#34;pixel54&#34;</span><span class=o>,</span><span class=s>&#34;pixel55&#34;</span><span class=o>,</span><span class=s>&#34;pixel56&#34;</span><span class=o>,</span><span class=s>&#34;pixel57&#34;</span><span class=o>,</span><span class=s>&#34;pixel58&#34;</span><span class=o>,</span><span class=s>&#34;pixel59&#34;</span><span class=o>,</span><span class=s>&#34;pixel60&#34;</span><span class=o>,</span><span class=s>&#34;pixel61&#34;</span><span class=o>,</span><span class=s>&#34;pixel62&#34;</span><span class=o>,</span><span class=s>&#34;pixel63&#34;</span><span class=o>,</span><span class=s>&#34;pixel64&#34;</span><span class=o>,</span><span class=s>&#34;pixel65&#34;</span><span class=o>,</span><span class=s>&#34;pixel66&#34;</span><span class=o>,</span><span class=s>&#34;pixel67&#34;</span><span class=o>,</span><span class=s>&#34;pixel68&#34;</span><span class=o>,</span><span class=s>&#34;pixel69&#34;</span><span class=o>,</span><span class=s>&#34;pixel70&#34;</span><span class=o>,</span><span class=s>&#34;pixel71&#34;</span><span class=o>,</span><span class=s>&#34;pixel72&#34;</span><span class=o>,</span><span class=s>&#34;pixel73&#34;</span><span class=o>,</span><span class=s>&#34;pixel74&#34;</span><span class=o>,</span><span class=s>&#34;pixel75&#34;</span><span class=o>,</span><span class=s>&#34;pixel76&#34;</span><span class=o>,</span><span class=s>&#34;pixel77&#34;</span><span class=o>,</span><span class=s>&#34;pixel78&#34;</span><span class=o>,</span><span class=s>&#34;pixel79&#34;</span><span class=o>,</span><span class=s>&#34;pixel80&#34;</span><span class=o>,</span><span class=s>&#34;pixel81&#34;</span><span class=o>,</span><span class=s>&#34;pixel82&#34;</span><span class=o>,</span><span class=s>&#34;pixel83&#34;</span><span class=o>,</span><span class=s>&#34;pixel84&#34;</span><span class=o>,</span><span class=s>&#34;pixel85&#34;</span><span class=o>,</span><span class=s>&#34;pixel86&#34;</span><span class=o>,</span><span class=s>&#34;pixel87&#34;</span><span class=o>,</span><span class=s>&#34;pixel88&#34;</span><span class=o>,</span><span class=s>&#34;pixel89&#34;</span><span class=o>,</span><span class=s>&#34;pixel90&#34;</span><span class=o>,</span><span class=s>&#34;pixel91&#34;</span><span class=o>,</span><span class=s>&#34;pixel92&#34;</span><span class=o>,</span><span class=s>&#34;pixel93&#34;</span><span class=o>,</span><span class=s>&#34;pixel94&#34;</span><span class=o>,</span><span class=s>&#34;pixel95&#34;</span><span class=o>,</span><span class=s>&#34;pixel96&#34;</span><span class=o>,</span><span class=s>&#34;pixel97&#34;</span><span class=o>,</span><span class=s>&#34;pixel98&#34;</span><span class=o>,</span><span class=s>&#34;pixel99&#34;</span><span class=o>,</span><span class=s>&#34;pixel100&#34;</span><span class=o>,</span><span class=s>&#34;pixel101&#34;</span><span class=o>,</span><span class=s>&#34;pixel102&#34;</span><span class=o>,</span><span class=s>&#34;pixel103&#34;</span><span class=o>,</span><span class=s>&#34;pixel104&#34;</span><span class=o>,</span><span class=s>&#34;pixel105&#34;</span><span class=o>,</span><span class=s>&#34;pixel106&#34;</span><span class=o>,</span><span class=s>&#34;pixel107&#34;</span><span class=o>,</span><span class=s>&#34;pixel108&#34;</span><span class=o>,</span><span class=s>&#34;pixel109&#34;</span><span class=o>,</span><span class=s>&#34;pixel110&#34;</span><span class=o>,</span><span class=s>&#34;pixel111&#34;</span><span class=o>,</span><span class=s>&#34;pixel112&#34;</span><span class=o>,</span><span class=s>&#34;pixel113&#34;</span><span class=o>,</span><span class=s>&#34;pixel114&#34;</span><span class=o>,</span><span class=s>&#34;pixel115&#34;</span><span class=o>,</span><span class=s>&#34;pixel116&#34;</span><span class=o>,</span><span class=s>&#34;pixel117&#34;</span><span class=o>,</span><span class=s>&#34;pixel118&#34;</span><span class=o>,</span><span class=s>&#34;pixel119&#34;</span><span class=o>,</span><span class=s>&#34;pixel120&#34;</span><span class=o>,</span><span class=s>&#34;pixel121&#34;</span><span class=o>,</span><span class=s>&#34;pixel122&#34;</span><span class=o>,</span><span class=s>&#34;pixel123&#34;</span><span class=o>,</span><span class=s>&#34;pixel124&#34;</span><span class=o>,</span><span class=s>&#34;pixel125&#34;</span><span class=o>,</span><span class=s>&#34;pixel126&#34;</span><span class=o>,</span><span class=s>&#34;pixel127&#34;</span><span class=o>,</span><span class=s>&#34;pixel128&#34;</span><span class=o>,</span><span class=s>&#34;pixel129&#34;</span><span class=o>,</span><span class=s>&#34;pixel130&#34;</span><span class=o>,</span><span class=s>&#34;pixel131&#34;</span><span class=o>,</span><span class=s>&#34;pixel132&#34;</span><span class=o>,</span><span class=s>&#34;pixel133&#34;</span><span class=o>,</span><span class=s>&#34;pixel134&#34;</span><span class=o>,</span><span class=s>&#34;pixel135&#34;</span><span class=o>,</span><span class=s>&#34;pixel136&#34;</span><span class=o>,</span><span class=s>&#34;pixel137&#34;</span><span class=o>,</span><span class=s>&#34;pixel138&#34;</span><span class=o>,</span><span class=s>&#34;pixel139&#34;</span><span class=o>,</span><span class=s>&#34;pixel140&#34;</span><span class=o>,</span><span class=s>&#34;pixel141&#34;</span><span class=o>,</span><span class=s>&#34;pixel142&#34;</span><span class=o>,</span><span class=s>&#34;pixel143&#34;</span><span class=o>,</span><span class=s>&#34;pixel144&#34;</span><span class=o>,</span><span class=s>&#34;pixel145&#34;</span><span class=o>,</span><span class=s>&#34;pixel146&#34;</span><span class=o>,</span><span class=s>&#34;pixel147&#34;</span><span class=o>,</span><span class=s>&#34;pixel148&#34;</span><span class=o>,</span><span class=s>&#34;pixel149&#34;</span><span class=o>,</span><span class=s>&#34;pixel150&#34;</span><span class=o>,</span><span class=s>&#34;pixel151&#34;</span><span class=o>,</span><span class=s>&#34;pixel152&#34;</span><span class=o>,</span><span class=s>&#34;pixel153&#34;</span><span class=o>,</span><span class=s>&#34;pixel154&#34;</span><span class=o>,</span><span class=s>&#34;pixel155&#34;</span><span class=o>,</span><span class=s>&#34;pixel156&#34;</span><span class=o>,</span><span class=s>&#34;pixel157&#34;</span><span class=o>,</span><span class=s>&#34;pixel158&#34;</span><span class=o>,</span><span class=s>&#34;pixel159&#34;</span><span class=o>,</span><span class=s>&#34;pixel160&#34;</span><span class=o>,</span><span class=s>&#34;pixel161&#34;</span><span class=o>,</span><span class=s>&#34;pixel162&#34;</span><span class=o>,</span><span class=s>&#34;pixel163&#34;</span><span class=o>,</span><span class=s>&#34;pixel164&#34;</span><span class=o>,</span><span class=s>&#34;pixel165&#34;</span><span class=o>,</span><span class=s>&#34;pixel166&#34;</span><span class=o>,</span><span class=s>&#34;pixel167&#34;</span><span class=o>,</span><span class=s>&#34;pixel168&#34;</span><span class=o>,</span><span class=s>&#34;pixel169&#34;</span><span class=o>,</span><span class=s>&#34;pixel170&#34;</span><span class=o>,</span><span class=s>&#34;pixel171&#34;</span><span class=o>,</span><span class=s>&#34;pixel172&#34;</span><span class=o>,</span><span class=s>&#34;pixel173&#34;</span><span class=o>,</span><span class=s>&#34;pixel174&#34;</span><span class=o>,</span><span class=s>&#34;pixel175&#34;</span><span class=o>,</span><span class=s>&#34;pixel176&#34;</span><span class=o>,</span><span class=s>&#34;pixel177&#34;</span><span class=o>,</span><span class=s>&#34;pixel178&#34;</span><span class=o>,</span><span class=s>&#34;pixel179&#34;</span><span class=o>,</span><span class=s>&#34;pixel180&#34;</span><span class=o>,</span><span class=s>&#34;pixel181&#34;</span><span class=o>,</span><span class=s>&#34;pixel182&#34;</span><span class=o>,</span><span class=s>&#34;pixel183&#34;</span><span class=o>,</span><span class=s>&#34;pixel184&#34;</span><span class=o>,</span><span class=s>&#34;pixel185&#34;</span><span class=o>,</span><span class=s>&#34;pixel186&#34;</span><span class=o>,</span><span class=s>&#34;pixel187&#34;</span><span class=o>,</span><span class=s>&#34;pixel188&#34;</span><span class=o>,</span><span class=s>&#34;pixel189&#34;</span><span class=o>,</span><span class=s>&#34;pixel190&#34;</span><span class=o>,</span><span class=s>&#34;pixel191&#34;</span><span class=o>,</span><span class=s>&#34;pixel192&#34;</span><span class=o>,</span><span class=s>&#34;pixel193&#34;</span><span class=o>,</span><span class=s>&#34;pixel194&#34;</span><span class=o>,</span><span class=s>&#34;pixel195&#34;</span><span class=o>,</span><span class=s>&#34;pixel196&#34;</span><span class=o>,</span><span class=s>&#34;pixel197&#34;</span><span class=o>,</span><span class=s>&#34;pixel198&#34;</span><span class=o>,</span><span class=s>&#34;pixel199&#34;</span><span class=o>,</span><span class=s>&#34;pixel200&#34;</span><span class=o>,</span><span class=s>&#34;pixel201&#34;</span><span class=o>,</span><span class=s>&#34;pixel202&#34;</span><span class=o>,</span><span class=s>&#34;pixel203&#34;</span><span class=o>,</span><span class=s>&#34;pixel204&#34;</span><span class=o>,</span><span class=s>&#34;pixel205&#34;</span><span class=o>,</span><span class=s>&#34;pixel206&#34;</span><span class=o>,</span><span class=s>&#34;pixel207&#34;</span><span class=o>,</span><span class=s>&#34;pixel208&#34;</span><span class=o>,</span><span class=s>&#34;pixel209&#34;</span><span class=o>,</span><span class=s>&#34;pixel210&#34;</span><span class=o>,</span><span class=s>&#34;pixel211&#34;</span><span class=o>,</span><span class=s>&#34;pixel212&#34;</span><span class=o>,</span><span class=s>&#34;pixel213&#34;</span><span class=o>,</span><span class=s>&#34;pixel214&#34;</span><span class=o>,</span><span class=s>&#34;pixel215&#34;</span><span class=o>,</span><span class=s>&#34;pixel216&#34;</span><span class=o>,</span><span class=s>&#34;pixel217&#34;</span><span class=o>,</span><span class=s>&#34;pixel218&#34;</span><span class=o>,</span><span class=s>&#34;pixel219&#34;</span><span class=o>,</span><span class=s>&#34;pixel220&#34;</span><span class=o>,</span><span class=s>&#34;pixel221&#34;</span><span class=o>,</span><span class=s>&#34;pixel222&#34;</span><span class=o>,</span><span class=s>&#34;pixel223&#34;</span><span class=o>,</span><span class=s>&#34;pixel224&#34;</span><span class=o>,</span><span class=s>&#34;pixel225&#34;</span><span class=o>,</span><span class=s>&#34;pixel226&#34;</span><span class=o>,</span><span class=s>&#34;pixel227&#34;</span><span class=o>,</span><span class=s>&#34;pixel228&#34;</span><span class=o>,</span><span class=s>&#34;pixel229&#34;</span><span class=o>,</span><span class=s>&#34;pixel230&#34;</span><span class=o>,</span><span class=s>&#34;pixel231&#34;</span><span class=o>,</span><span class=s>&#34;pixel232&#34;</span><span class=o>,</span><span class=s>&#34;pixel233&#34;</span><span class=o>,</span><span class=s>&#34;pixel234&#34;</span><span class=o>,</span><span class=s>&#34;pixel235&#34;</span><span class=o>,</span><span class=s>&#34;pixel236&#34;</span><span class=o>,</span><span class=s>&#34;pixel237&#34;</span><span class=o>,</span><span class=s>&#34;pixel238&#34;</span><span class=o>,</span><span class=s>&#34;pixel239&#34;</span><span class=o>,</span><span class=s>&#34;pixel240&#34;</span><span class=o>,</span><span class=s>&#34;pixel241&#34;</span><span class=o>,</span><span class=s>&#34;pixel242&#34;</span><span class=o>,</span><span class=s>&#34;pixel243&#34;</span><span class=o>,</span><span class=s>&#34;pixel244&#34;</span><span class=o>,</span><span class=s>&#34;pixel245&#34;</span><span class=o>,</span><span class=s>&#34;pixel246&#34;</span><span class=o>,</span><span class=s>&#34;pixel247&#34;</span><span class=o>,</span><span class=s>&#34;pixel248&#34;</span><span class=o>,</span><span class=s>&#34;pixel249&#34;</span><span class=o>,</span><span class=s>&#34;pixel250&#34;</span><span class=o>,</span><span class=s>&#34;pixel251&#34;</span><span class=o>,</span><span class=s>&#34;pixel252&#34;</span><span class=o>,</span><span class=s>&#34;pixel253&#34;</span><span class=o>,</span><span class=s>&#34;pixel254&#34;</span><span class=o>,</span><span class=s>&#34;pixel255&#34;</span><span class=o>,</span><span class=s>&#34;pixel256&#34;</span><span class=o>,</span><span class=s>&#34;pixel257&#34;</span><span class=o>,</span><span class=s>&#34;pixel258&#34;</span><span class=o>,</span><span class=s>&#34;pixel259&#34;</span><span class=o>,</span><span class=s>&#34;pixel260&#34;</span><span class=o>,</span><span class=s>&#34;pixel261&#34;</span><span class=o>,</span><span class=s>&#34;pixel262&#34;</span><span class=o>,</span><span class=s>&#34;pixel263&#34;</span><span class=o>,</span><span class=s>&#34;pixel264&#34;</span><span class=o>,</span><span class=s>&#34;pixel265&#34;</span><span class=o>,</span><span class=s>&#34;pixel266&#34;</span><span class=o>,</span><span class=s>&#34;pixel267&#34;</span><span class=o>,</span><span class=s>&#34;pixel268&#34;</span><span class=o>,</span><span class=s>&#34;pixel269&#34;</span><span class=o>,</span><span class=s>&#34;pixel270&#34;</span><span class=o>,</span><span class=s>&#34;pixel271&#34;</span><span class=o>,</span><span class=s>&#34;pixel272&#34;</span><span class=o>,</span><span class=s>&#34;pixel273&#34;</span><span class=o>,</span><span class=s>&#34;pixel274&#34;</span><span class=o>,</span><span class=s>&#34;pixel275&#34;</span><span class=o>,</span><span class=s>&#34;pixel276&#34;</span><span class=o>,</span><span class=s>&#34;pixel277&#34;</span><span class=o>,</span><span class=s>&#34;pixel278&#34;</span><span class=o>,</span><span class=s>&#34;pixel279&#34;</span><span class=o>,</span><span class=s>&#34;pixel280&#34;</span><span class=o>,</span><span class=s>&#34;pixel281&#34;</span><span class=o>,</span><span class=s>&#34;pixel282&#34;</span><span class=o>,</span><span class=s>&#34;pixel283&#34;</span><span class=o>,</span><span class=s>&#34;pixel284&#34;</span><span class=o>,</span><span class=s>&#34;pixel285&#34;</span><span class=o>,</span><span class=s>&#34;pixel286&#34;</span><span class=o>,</span><span class=s>&#34;pixel287&#34;</span><span class=o>,</span><span class=s>&#34;pixel288&#34;</span><span class=o>,</span><span class=s>&#34;pixel289&#34;</span><span class=o>,</span><span class=s>&#34;pixel290&#34;</span><span class=o>,</span><span class=s>&#34;pixel291&#34;</span><span class=o>,</span><span class=s>&#34;pixel292&#34;</span><span class=o>,</span><span class=s>&#34;pixel293&#34;</span><span class=o>,</span><span class=s>&#34;pixel294&#34;</span><span class=o>,</span><span class=s>&#34;pixel295&#34;</span><span class=o>,</span><span class=s>&#34;pixel296&#34;</span><span class=o>,</span><span class=s>&#34;pixel297&#34;</span><span class=o>,</span><span class=s>&#34;pixel298&#34;</span><span class=o>,</span><span class=s>&#34;pixel299&#34;</span><span class=o>,</span><span class=s>&#34;pixel300&#34;</span><span class=o>,</span><span class=s>&#34;pixel301&#34;</span><span class=o>,</span><span class=s>&#34;pixel302&#34;</span><span class=o>,</span><span class=s>&#34;pixel303&#34;</span><span class=o>,</span><span class=s>&#34;pixel304&#34;</span><span class=o>,</span><span class=s>&#34;pixel305&#34;</span><span class=o>,</span><span class=s>&#34;pixel306&#34;</span><span class=o>,</span><span class=s>&#34;pixel307&#34;</span><span class=o>,</span><span class=s>&#34;pixel308&#34;</span><span class=o>,</span><span class=s>&#34;pixel309&#34;</span><span class=o>,</span><span class=s>&#34;pixel310&#34;</span><span class=o>,</span><span class=s>&#34;pixel311&#34;</span><span class=o>,</span><span class=s>&#34;pixel312&#34;</span><span class=o>,</span><span class=s>&#34;pixel313&#34;</span><span class=o>,</span><span class=s>&#34;pixel314&#34;</span><span class=o>,</span><span class=s>&#34;pixel315&#34;</span><span class=o>,</span><span class=s>&#34;pixel316&#34;</span><span class=o>,</span><span class=s>&#34;pixel317&#34;</span><span class=o>,</span><span class=s>&#34;pixel318&#34;</span><span class=o>,</span><span class=s>&#34;pixel319&#34;</span><span class=o>,</span><span class=s>&#34;pixel320&#34;</span><span class=o>,</span><span class=s>&#34;pixel321&#34;</span><span class=o>,</span><span class=s>&#34;pixel322&#34;</span><span class=o>,</span><span class=s>&#34;pixel323&#34;</span><span class=o>,</span><span class=s>&#34;pixel324&#34;</span><span class=o>,</span><span class=s>&#34;pixel325&#34;</span><span class=o>,</span><span class=s>&#34;pixel326&#34;</span><span class=o>,</span><span class=s>&#34;pixel327&#34;</span><span class=o>,</span><span class=s>&#34;pixel328&#34;</span><span class=o>,</span><span class=s>&#34;pixel329&#34;</span><span class=o>,</span><span class=s>&#34;pixel330&#34;</span><span class=o>,</span><span class=s>&#34;pixel331&#34;</span><span class=o>,</span><span class=s>&#34;pixel332&#34;</span><span class=o>,</span><span class=s>&#34;pixel333&#34;</span><span class=o>,</span><span class=s>&#34;pixel334&#34;</span><span class=o>,</span><span class=s>&#34;pixel335&#34;</span><span class=o>,</span><span class=s>&#34;pixel336&#34;</span><span class=o>,</span><span class=s>&#34;pixel337&#34;</span><span class=o>,</span><span class=s>&#34;pixel338&#34;</span><span class=o>,</span><span class=s>&#34;pixel339&#34;</span><span class=o>,</span><span class=s>&#34;pixel340&#34;</span><span class=o>,</span><span class=s>&#34;pixel341&#34;</span><span class=o>,</span><span class=s>&#34;pixel342&#34;</span><span class=o>,</span><span class=s>&#34;pixel343&#34;</span><span class=o>,</span><span class=s>&#34;pixel344&#34;</span><span class=o>,</span><span class=s>&#34;pixel345&#34;</span><span class=o>,</span><span class=s>&#34;pixel346&#34;</span><span class=o>,</span><span class=s>&#34;pixel347&#34;</span><span class=o>,</span><span class=s>&#34;pixel348&#34;</span><span class=o>,</span><span class=s>&#34;pixel349&#34;</span><span class=o>,</span><span class=s>&#34;pixel350&#34;</span><span class=o>,</span><span class=s>&#34;pixel351&#34;</span><span class=o>,</span><span class=s>&#34;pixel352&#34;</span><span class=o>,</span><span class=s>&#34;pixel353&#34;</span><span class=o>,</span><span class=s>&#34;pixel354&#34;</span><span class=o>,</span><span class=s>&#34;pixel355&#34;</span><span class=o>,</span><span class=s>&#34;pixel356&#34;</span><span class=o>,</span><span class=s>&#34;pixel357&#34;</span><span class=o>,</span><span class=s>&#34;pixel358&#34;</span><span class=o>,</span><span class=s>&#34;pixel359&#34;</span><span class=o>,</span><span class=s>&#34;pixel360&#34;</span><span class=o>,</span><span class=s>&#34;pixel361&#34;</span><span class=o>,</span><span class=s>&#34;pixel362&#34;</span><span class=o>,</span><span class=s>&#34;pixel363&#34;</span><span class=o>,</span><span class=s>&#34;pixel364&#34;</span><span class=o>,</span><span class=s>&#34;pixel365&#34;</span><span class=o>,</span><span class=s>&#34;pixel366&#34;</span><span class=o>,</span><span class=s>&#34;pixel367&#34;</span><span class=o>,</span><span class=s>&#34;pixel368&#34;</span><span class=o>,</span><span class=s>&#34;pixel369&#34;</span><span class=o>,</span><span class=s>&#34;pixel370&#34;</span><span class=o>,</span><span class=s>&#34;pixel371&#34;</span><span class=o>,</span><span class=s>&#34;pixel372&#34;</span><span class=o>,</span><span class=s>&#34;pixel373&#34;</span><span class=o>,</span><span class=s>&#34;pixel374&#34;</span><span class=o>,</span><span class=s>&#34;pixel375&#34;</span><span class=o>,</span><span class=s>&#34;pixel376&#34;</span><span class=o>,</span><span class=s>&#34;pixel377&#34;</span><span class=o>,</span><span class=s>&#34;pixel378&#34;</span><span class=o>,</span><span class=s>&#34;pixel379&#34;</span><span class=o>,</span><span class=s>&#34;pixel380&#34;</span><span class=o>,</span><span class=s>&#34;pixel381&#34;</span><span class=o>,</span><span class=s>&#34;pixel382&#34;</span><span class=o>,</span><span class=s>&#34;pixel383&#34;</span><span class=o>,</span><span class=s>&#34;pixel384&#34;</span><span class=o>,</span><span class=s>&#34;pixel385&#34;</span><span class=o>,</span><span class=s>&#34;pixel386&#34;</span><span class=o>,</span><span class=s>&#34;pixel387&#34;</span><span class=o>,</span><span class=s>&#34;pixel388&#34;</span><span class=o>,</span><span class=s>&#34;pixel389&#34;</span><span class=o>,</span><span class=s>&#34;pixel390&#34;</span><span class=o>,</span><span class=s>&#34;pixel391&#34;</span><span class=o>,</span><span class=s>&#34;pixel392&#34;</span><span class=o>,</span><span class=s>&#34;pixel393&#34;</span><span class=o>,</span><span class=s>&#34;pixel394&#34;</span><span class=o>,</span><span class=s>&#34;pixel395&#34;</span><span class=o>,</span><span class=s>&#34;pixel396&#34;</span><span class=o>,</span><span class=s>&#34;pixel397&#34;</span><span class=o>,</span><span class=s>&#34;pixel398&#34;</span><span class=o>,</span><span class=s>&#34;pixel399&#34;</span><span class=o>,</span><span class=s>&#34;pixel400&#34;</span><span class=o>,</span><span class=s>&#34;pixel401&#34;</span><span class=o>,</span><span class=s>&#34;pixel402&#34;</span><span class=o>,</span><span class=s>&#34;pixel403&#34;</span><span class=o>,</span><span class=s>&#34;pixel404&#34;</span><span class=o>,</span><span class=s>&#34;pixel405&#34;</span><span class=o>,</span><span class=s>&#34;pixel406&#34;</span><span class=o>,</span><span class=s>&#34;pixel407&#34;</span><span class=o>,</span><span class=s>&#34;pixel408&#34;</span><span class=o>,</span><span class=s>&#34;pixel409&#34;</span><span class=o>,</span><span class=s>&#34;pixel410&#34;</span><span class=o>,</span><span class=s>&#34;pixel411&#34;</span><span class=o>,</span><span class=s>&#34;pixel412&#34;</span><span class=o>,</span><span class=s>&#34;pixel413&#34;</span><span class=o>,</span><span class=s>&#34;pixel414&#34;</span><span class=o>,</span><span class=s>&#34;pixel415&#34;</span><span class=o>,</span><span class=s>&#34;pixel416&#34;</span><span class=o>,</span><span class=s>&#34;pixel417&#34;</span><span class=o>,</span><span class=s>&#34;pixel418&#34;</span><span class=o>,</span><span class=s>&#34;pixel419&#34;</span><span class=o>,</span><span class=s>&#34;pixel420&#34;</span><span class=o>,</span><span class=s>&#34;pixel421&#34;</span><span class=o>,</span><span class=s>&#34;pixel422&#34;</span><span class=o>,</span><span class=s>&#34;pixel423&#34;</span><span class=o>,</span><span class=s>&#34;pixel424&#34;</span><span class=o>,</span><span class=s>&#34;pixel425&#34;</span><span class=o>,</span><span class=s>&#34;pixel426&#34;</span><span class=o>,</span><span class=s>&#34;pixel427&#34;</span><span class=o>,</span><span class=s>&#34;pixel428&#34;</span><span class=o>,</span><span class=s>&#34;pixel429&#34;</span><span class=o>,</span><span class=s>&#34;pixel430&#34;</span><span class=o>,</span><span class=s>&#34;pixel431&#34;</span><span class=o>,</span><span class=s>&#34;pixel432&#34;</span><span class=o>,</span><span class=s>&#34;pixel433&#34;</span><span class=o>,</span><span class=s>&#34;pixel434&#34;</span><span class=o>,</span><span class=s>&#34;pixel435&#34;</span><span class=o>,</span><span class=s>&#34;pixel436&#34;</span><span class=o>,</span><span class=s>&#34;pixel437&#34;</span><span class=o>,</span><span class=s>&#34;pixel438&#34;</span><span class=o>,</span><span class=s>&#34;pixel439&#34;</span><span class=o>,</span><span class=s>&#34;pixel440&#34;</span><span class=o>,</span><span class=s>&#34;pixel441&#34;</span><span class=o>,</span><span class=s>&#34;pixel442&#34;</span><span class=o>,</span><span class=s>&#34;pixel443&#34;</span><span class=o>,</span><span class=s>&#34;pixel444&#34;</span><span class=o>,</span><span class=s>&#34;pixel445&#34;</span><span class=o>,</span><span class=s>&#34;pixel446&#34;</span><span class=o>,</span><span class=s>&#34;pixel447&#34;</span><span class=o>,</span><span class=s>&#34;pixel448&#34;</span><span class=o>,</span><span class=s>&#34;pixel449&#34;</span><span class=o>,</span><span class=s>&#34;pixel450&#34;</span><span class=o>,</span><span class=s>&#34;pixel451&#34;</span><span class=o>,</span><span class=s>&#34;pixel452&#34;</span><span class=o>,</span><span class=s>&#34;pixel453&#34;</span><span class=o>,</span><span class=s>&#34;pixel454&#34;</span><span class=o>,</span><span class=s>&#34;pixel455&#34;</span><span class=o>,</span><span class=s>&#34;pixel456&#34;</span><span class=o>,</span><span class=s>&#34;pixel457&#34;</span><span class=o>,</span><span class=s>&#34;pixel458&#34;</span><span class=o>,</span><span class=s>&#34;pixel459&#34;</span><span class=o>,</span><span class=s>&#34;pixel460&#34;</span><span class=o>,</span><span class=s>&#34;pixel461&#34;</span><span class=o>,</span><span class=s>&#34;pixel462&#34;</span><span class=o>,</span><span class=s>&#34;pixel463&#34;</span><span class=o>,</span><span class=s>&#34;pixel464&#34;</span><span class=o>,</span><span class=s>&#34;pixel465&#34;</span><span class=o>,</span><span class=s>&#34;pixel466&#34;</span><span class=o>,</span><span class=s>&#34;pixel467&#34;</span><span class=o>,</span><span class=s>&#34;pixel468&#34;</span><span class=o>,</span><span class=s>&#34;pixel469&#34;</span><span class=o>,</span><span class=s>&#34;pixel470&#34;</span><span class=o>,</span><span class=s>&#34;pixel471&#34;</span><span class=o>,</span><span class=s>&#34;pixel472&#34;</span><span class=o>,</span><span class=s>&#34;pixel473&#34;</span><span class=o>,</span><span class=s>&#34;pixel474&#34;</span><span class=o>,</span><span class=s>&#34;pixel475&#34;</span><span class=o>,</span><span class=s>&#34;pixel476&#34;</span><span class=o>,</span><span class=s>&#34;pixel477&#34;</span><span class=o>,</span><span class=s>&#34;pixel478&#34;</span><span class=o>,</span><span class=s>&#34;pixel479&#34;</span><span class=o>,</span><span class=s>&#34;pixel480&#34;</span><span class=o>,</span><span class=s>&#34;pixel481&#34;</span><span class=o>,</span><span class=s>&#34;pixel482&#34;</span><span class=o>,</span><span class=s>&#34;pixel483&#34;</span><span class=o>,</span><span class=s>&#34;pixel484&#34;</span><span class=o>,</span><span class=s>&#34;pixel485&#34;</span><span class=o>,</span><span class=s>&#34;pixel486&#34;</span><span class=o>,</span><span class=s>&#34;pixel487&#34;</span><span class=o>,</span><span class=s>&#34;pixel488&#34;</span><span class=o>,</span><span class=s>&#34;pixel489&#34;</span><span class=o>,</span><span class=s>&#34;pixel490&#34;</span><span class=o>,</span><span class=s>&#34;pixel491&#34;</span><span class=o>,</span><span class=s>&#34;pixel492&#34;</span><span class=o>,</span><span class=s>&#34;pixel493&#34;</span><span class=o>,</span><span class=s>&#34;pixel494&#34;</span><span class=o>,</span><span class=s>&#34;pixel495&#34;</span><span class=o>,</span><span class=s>&#34;pixel496&#34;</span><span class=o>,</span><span class=s>&#34;pixel497&#34;</span><span class=o>,</span><span class=s>&#34;pixel498&#34;</span><span class=o>,</span><span class=s>&#34;pixel499&#34;</span><span class=o>,</span><span class=s>&#34;pixel500&#34;</span><span class=o>,</span><span class=s>&#34;pixel501&#34;</span><span class=o>,</span><span class=s>&#34;pixel502&#34;</span><span class=o>,</span><span class=s>&#34;pixel503&#34;</span><span class=o>,</span><span class=s>&#34;pixel504&#34;</span><span class=o>,</span><span class=s>&#34;pixel505&#34;</span><span class=o>,</span><span class=s>&#34;pixel506&#34;</span><span class=o>,</span><span class=s>&#34;pixel507&#34;</span><span class=o>,</span><span class=s>&#34;pixel508&#34;</span><span class=o>,</span><span class=s>&#34;pixel509&#34;</span><span class=o>,</span><span class=s>&#34;pixel510&#34;</span><span class=o>,</span><span class=s>&#34;pixel511&#34;</span><span class=o>,</span><span class=s>&#34;pixel512&#34;</span><span class=o>,</span><span class=s>&#34;pixel513&#34;</span><span class=o>,</span><span class=s>&#34;pixel514&#34;</span><span class=o>,</span><span class=s>&#34;pixel515&#34;</span><span class=o>,</span><span class=s>&#34;pixel516&#34;</span><span class=o>,</span><span class=s>&#34;pixel517&#34;</span><span class=o>,</span><span class=s>&#34;pixel518&#34;</span><span class=o>,</span><span class=s>&#34;pixel519&#34;</span><span class=o>,</span><span class=s>&#34;pixel520&#34;</span><span class=o>,</span><span class=s>&#34;pixel521&#34;</span><span class=o>,</span><span class=s>&#34;pixel522&#34;</span><span class=o>,</span><span class=s>&#34;pixel523&#34;</span><span class=o>,</span><span class=s>&#34;pixel524&#34;</span><span class=o>,</span><span class=s>&#34;pixel525&#34;</span><span class=o>,</span><span class=s>&#34;pixel526&#34;</span><span class=o>,</span><span class=s>&#34;pixel527&#34;</span><span class=o>,</span><span class=s>&#34;pixel528&#34;</span><span class=o>,</span><span class=s>&#34;pixel529&#34;</span><span class=o>,</span><span class=s>&#34;pixel530&#34;</span><span class=o>,</span><span class=s>&#34;pixel531&#34;</span><span class=o>,</span><span class=s>&#34;pixel532&#34;</span><span class=o>,</span><span class=s>&#34;pixel533&#34;</span><span class=o>,</span><span class=s>&#34;pixel534&#34;</span><span class=o>,</span><span class=s>&#34;pixel535&#34;</span><span class=o>,</span><span class=s>&#34;pixel536&#34;</span><span class=o>,</span><span class=s>&#34;pixel537&#34;</span><span class=o>,</span><span class=s>&#34;pixel538&#34;</span><span class=o>,</span><span class=s>&#34;pixel539&#34;</span><span class=o>,</span><span class=s>&#34;pixel540&#34;</span><span class=o>,</span><span class=s>&#34;pixel541&#34;</span><span class=o>,</span><span class=s>&#34;pixel542&#34;</span><span class=o>,</span><span class=s>&#34;pixel543&#34;</span><span class=o>,</span><span class=s>&#34;pixel544&#34;</span><span class=o>,</span><span class=s>&#34;pixel545&#34;</span><span class=o>,</span><span class=s>&#34;pixel546&#34;</span><span class=o>,</span><span class=s>&#34;pixel547&#34;</span><span class=o>,</span><span class=s>&#34;pixel548&#34;</span><span class=o>,</span><span class=s>&#34;pixel549&#34;</span><span class=o>,</span><span class=s>&#34;pixel550&#34;</span><span class=o>,</span><span class=s>&#34;pixel551&#34;</span><span class=o>,</span><span class=s>&#34;pixel552&#34;</span><span class=o>,</span><span class=s>&#34;pixel553&#34;</span><span class=o>,</span><span class=s>&#34;pixel554&#34;</span><span class=o>,</span><span class=s>&#34;pixel555&#34;</span><span class=o>,</span><span class=s>&#34;pixel556&#34;</span><span class=o>,</span><span class=s>&#34;pixel557&#34;</span><span class=o>,</span><span class=s>&#34;pixel558&#34;</span><span class=o>,</span><span class=s>&#34;pixel559&#34;</span><span class=o>,</span><span class=s>&#34;pixel560&#34;</span><span class=o>,</span><span class=s>&#34;pixel561&#34;</span><span class=o>,</span><span class=s>&#34;pixel562&#34;</span><span class=o>,</span><span class=s>&#34;pixel563&#34;</span><span class=o>,</span><span class=s>&#34;pixel564&#34;</span><span class=o>,</span><span class=s>&#34;pixel565&#34;</span><span class=o>,</span><span class=s>&#34;pixel566&#34;</span><span class=o>,</span><span class=s>&#34;pixel567&#34;</span><span class=o>,</span><span class=s>&#34;pixel568&#34;</span><span class=o>,</span><span class=s>&#34;pixel569&#34;</span><span class=o>,</span><span class=s>&#34;pixel570&#34;</span><span class=o>,</span><span class=s>&#34;pixel571&#34;</span><span class=o>,</span><span class=s>&#34;pixel572&#34;</span><span class=o>,</span><span class=s>&#34;pixel573&#34;</span><span class=o>,</span><span class=s>&#34;pixel574&#34;</span><span class=o>,</span><span class=s>&#34;pixel575&#34;</span><span class=o>,</span><span class=s>&#34;pixel576&#34;</span><span class=o>,</span><span class=s>&#34;pixel577&#34;</span><span class=o>,</span><span class=s>&#34;pixel578&#34;</span><span class=o>,</span><span class=s>&#34;pixel579&#34;</span><span class=o>,</span><span class=s>&#34;pixel580&#34;</span><span class=o>,</span><span class=s>&#34;pixel581&#34;</span><span class=o>,</span><span class=s>&#34;pixel582&#34;</span><span class=o>,</span><span class=s>&#34;pixel583&#34;</span><span class=o>,</span><span class=s>&#34;pixel584&#34;</span><span class=o>,</span><span class=s>&#34;pixel585&#34;</span><span class=o>,</span><span class=s>&#34;pixel586&#34;</span><span class=o>,</span><span class=s>&#34;pixel587&#34;</span><span class=o>,</span><span class=s>&#34;pixel588&#34;</span><span class=o>,</span><span class=s>&#34;pixel589&#34;</span><span class=o>,</span><span class=s>&#34;pixel590&#34;</span><span class=o>,</span><span class=s>&#34;pixel591&#34;</span><span class=o>,</span><span class=s>&#34;pixel592&#34;</span><span class=o>,</span><span class=s>&#34;pixel593&#34;</span><span class=o>,</span><span class=s>&#34;pixel594&#34;</span><span class=o>,</span><span class=s>&#34;pixel595&#34;</span><span class=o>,</span><span class=s>&#34;pixel596&#34;</span><span class=o>,</span><span class=s>&#34;pixel597&#34;</span><span class=o>,</span><span class=s>&#34;pixel598&#34;</span><span class=o>,</span><span class=s>&#34;pixel599&#34;</span><span class=o>,</span><span class=s>&#34;pixel600&#34;</span><span class=o>,</span><span class=s>&#34;pixel601&#34;</span><span class=o>,</span><span class=s>&#34;pixel602&#34;</span><span class=o>,</span><span class=s>&#34;pixel603&#34;</span><span class=o>,</span><span class=s>&#34;pixel604&#34;</span><span class=o>,</span><span class=s>&#34;pixel605&#34;</span><span class=o>,</span><span class=s>&#34;pixel606&#34;</span><span class=o>,</span><span class=s>&#34;pixel607&#34;</span><span class=o>,</span><span class=s>&#34;pixel608&#34;</span><span class=o>,</span><span class=s>&#34;pixel609&#34;</span><span class=o>,</span><span class=s>&#34;pixel610&#34;</span><span class=o>,</span><span class=s>&#34;pixel611&#34;</span><span class=o>,</span><span class=s>&#34;pixel612&#34;</span><span class=o>,</span><span class=s>&#34;pixel613&#34;</span><span class=o>,</span><span class=s>&#34;pixel614&#34;</span><span class=o>,</span><span class=s>&#34;pixel615&#34;</span><span class=o>,</span><span class=s>&#34;pixel616&#34;</span><span class=o>,</span><span class=s>&#34;pixel617&#34;</span><span class=o>,</span><span class=s>&#34;pixel618&#34;</span><span class=o>,</span><span class=s>&#34;pixel619&#34;</span><span class=o>,</span><span class=s>&#34;pixel620&#34;</span><span class=o>,</span><span class=s>&#34;pixel621&#34;</span><span class=o>,</span><span class=s>&#34;pixel622&#34;</span><span class=o>,</span><span class=s>&#34;pixel623&#34;</span><span class=o>,</span><span class=s>&#34;pixel624&#34;</span><span class=o>,</span><span class=s>&#34;pixel625&#34;</span><span class=o>,</span><span class=s>&#34;pixel626&#34;</span><span class=o>,</span><span class=s>&#34;pixel627&#34;</span><span class=o>,</span><span class=s>&#34;pixel628&#34;</span><span class=o>,</span><span class=s>&#34;pixel629&#34;</span><span class=o>,</span><span class=s>&#34;pixel630&#34;</span><span class=o>,</span><span class=s>&#34;pixel631&#34;</span><span class=o>,</span><span class=s>&#34;pixel632&#34;</span><span class=o>,</span><span class=s>&#34;pixel633&#34;</span><span class=o>,</span><span class=s>&#34;pixel634&#34;</span><span class=o>,</span><span class=s>&#34;pixel635&#34;</span><span class=o>,</span><span class=s>&#34;pixel636&#34;</span><span class=o>,</span><span class=s>&#34;pixel637&#34;</span><span class=o>,</span><span class=s>&#34;pixel638&#34;</span><span class=o>,</span><span class=s>&#34;pixel639&#34;</span><span class=o>,</span><span class=s>&#34;pixel640&#34;</span><span class=o>,</span><span class=s>&#34;pixel641&#34;</span><span class=o>,</span><span class=s>&#34;pixel642&#34;</span><span class=o>,</span><span class=s>&#34;pixel643&#34;</span><span class=o>,</span><span class=s>&#34;pixel644&#34;</span><span class=o>,</span><span class=s>&#34;pixel645&#34;</span><span class=o>,</span><span class=s>&#34;pixel646&#34;</span><span class=o>,</span><span class=s>&#34;pixel647&#34;</span><span class=o>,</span><span class=s>&#34;pixel648&#34;</span><span class=o>,</span><span class=s>&#34;pixel649&#34;</span><span class=o>,</span><span class=s>&#34;pixel650&#34;</span><span class=o>,</span><span class=s>&#34;pixel651&#34;</span><span class=o>,</span><span class=s>&#34;pixel652&#34;</span><span class=o>,</span><span class=s>&#34;pixel653&#34;</span><span class=o>,</span><span class=s>&#34;pixel654&#34;</span><span class=o>,</span><span class=s>&#34;pixel655&#34;</span><span class=o>,</span><span class=s>&#34;pixel656&#34;</span><span class=o>,</span><span class=s>&#34;pixel657&#34;</span><span class=o>,</span><span class=s>&#34;pixel658&#34;</span><span class=o>,</span><span class=s>&#34;pixel659&#34;</span><span class=o>,</span><span class=s>&#34;pixel660&#34;</span><span class=o>,</span><span class=s>&#34;pixel661&#34;</span><span class=o>,</span><span class=s>&#34;pixel662&#34;</span><span class=o>,</span><span class=s>&#34;pixel663&#34;</span><span class=o>,</span><span class=s>&#34;pixel664&#34;</span><span class=o>,</span><span class=s>&#34;pixel665&#34;</span><span class=o>,</span><span class=s>&#34;pixel666&#34;</span><span class=o>,</span><span class=s>&#34;pixel667&#34;</span><span class=o>,</span><span class=s>&#34;pixel668&#34;</span><span class=o>,</span><span class=s>&#34;pixel669&#34;</span><span class=o>,</span><span class=s>&#34;pixel670&#34;</span><span class=o>,</span><span class=s>&#34;pixel671&#34;</span><span class=o>,</span><span class=s>&#34;pixel672&#34;</span><span class=o>,</span><span class=s>&#34;pixel673&#34;</span><span class=o>,</span><span class=s>&#34;pixel674&#34;</span><span class=o>,</span><span class=s>&#34;pixel675&#34;</span><span class=o>,</span><span class=s>&#34;pixel676&#34;</span><span class=o>,</span><span class=s>&#34;pixel677&#34;</span><span class=o>,</span><span class=s>&#34;pixel678&#34;</span><span class=o>,</span><span class=s>&#34;pixel679&#34;</span><span class=o>,</span><span class=s>&#34;pixel680&#34;</span><span class=o>,</span><span class=s>&#34;pixel681&#34;</span><span class=o>,</span><span class=s>&#34;pixel682&#34;</span><span class=o>,</span><span class=s>&#34;pixel683&#34;</span><span class=o>,</span><span class=s>&#34;pixel684&#34;</span><span class=o>,</span><span class=s>&#34;pixel685&#34;</span><span class=o>,</span><span class=s>&#34;pixel686&#34;</span><span class=o>,</span><span class=s>&#34;pixel687&#34;</span><span class=o>,</span><span class=s>&#34;pixel688&#34;</span><span class=o>,</span><span class=s>&#34;pixel689&#34;</span><span class=o>,</span><span class=s>&#34;pixel690&#34;</span><span class=o>,</span><span class=s>&#34;pixel691&#34;</span><span class=o>,</span><span class=s>&#34;pixel692&#34;</span><span class=o>,</span><span class=s>&#34;pixel693&#34;</span><span class=o>,</span><span class=s>&#34;pixel694&#34;</span><span class=o>,</span><span class=s>&#34;pixel695&#34;</span><span class=o>,</span><span class=s>&#34;pixel696&#34;</span><span class=o>,</span><span class=s>&#34;pixel697&#34;</span><span class=o>,</span><span class=s>&#34;pixel698&#34;</span><span class=o>,</span><span class=s>&#34;pixel699&#34;</span><span class=o>,</span><span class=s>&#34;pixel700&#34;</span><span class=o>,</span><span class=s>&#34;pixel701&#34;</span><span class=o>,</span><span class=s>&#34;pixel702&#34;</span><span class=o>,</span><span class=s>&#34;pixel703&#34;</span><span class=o>,</span><span class=s>&#34;pixel704&#34;</span><span class=o>,</span><span class=s>&#34;pixel705&#34;</span><span class=o>,</span><span class=s>&#34;pixel706&#34;</span><span class=o>,</span><span class=s>&#34;pixel707&#34;</span><span class=o>,</span><span class=s>&#34;pixel708&#34;</span><span class=o>,</span><span class=s>&#34;pixel709&#34;</span><span class=o>,</span><span class=s>&#34;pixel710&#34;</span><span class=o>,</span><span class=s>&#34;pixel711&#34;</span><span class=o>,</span><span class=s>&#34;pixel712&#34;</span><span class=o>,</span><span class=s>&#34;pixel713&#34;</span><span class=o>,</span><span class=s>&#34;pixel714&#34;</span><span class=o>,</span><span class=s>&#34;pixel715&#34;</span><span class=o>,</span><span class=s>&#34;pixel716&#34;</span><span class=o>,</span><span class=s>&#34;pixel717&#34;</span><span class=o>,</span><span class=s>&#34;pixel718&#34;</span><span class=o>,</span><span class=s>&#34;pixel719&#34;</span><span class=o>,</span><span class=s>&#34;pixel720&#34;</span><span class=o>,</span><span class=s>&#34;pixel721&#34;</span><span class=o>,</span><span class=s>&#34;pixel722&#34;</span><span class=o>,</span><span class=s>&#34;pixel723&#34;</span><span class=o>,</span><span class=s>&#34;pixel724&#34;</span><span class=o>,</span><span class=s>&#34;pixel725&#34;</span><span class=o>,</span><span class=s>&#34;pixel726&#34;</span><span class=o>,</span><span class=s>&#34;pixel727&#34;</span><span class=o>,</span><span class=s>&#34;pixel728&#34;</span><span class=o>,</span><span class=s>&#34;pixel729&#34;</span><span class=o>,</span><span class=s>&#34;pixel730&#34;</span><span class=o>,</span><span class=s>&#34;pixel731&#34;</span><span class=o>,</span><span class=s>&#34;pixel732&#34;</span><span class=o>,</span><span class=s>&#34;pixel733&#34;</span><span class=o>,</span><span class=s>&#34;pixel734&#34;</span><span class=o>,</span><span class=s>&#34;pixel735&#34;</span><span class=o>,</span><span class=s>&#34;pixel736&#34;</span><span class=o>,</span><span class=s>&#34;pixel737&#34;</span><span class=o>,</span><span class=s>&#34;pixel738&#34;</span><span class=o>,</span><span class=s>&#34;pixel739&#34;</span><span class=o>,</span><span class=s>&#34;pixel740&#34;</span><span class=o>,</span><span class=s>&#34;pixel741&#34;</span><span class=o>,</span><span class=s>&#34;pixel742&#34;</span><span class=o>,</span><span class=s>&#34;pixel743&#34;</span><span class=o>,</span><span class=s>&#34;pixel744&#34;</span><span class=o>,</span><span class=s>&#34;pixel745&#34;</span><span class=o>,</span><span class=s>&#34;pixel746&#34;</span><span class=o>,</span><span class=s>&#34;pixel747&#34;</span><span class=o>,</span><span class=s>&#34;pixel748&#34;</span><span class=o>,</span><span class=s>&#34;pixel749&#34;</span><span class=o>,</span><span class=s>&#34;pixel750&#34;</span><span class=o>,</span><span class=s>&#34;pixel751&#34;</span><span class=o>,</span><span class=s>&#34;pixel752&#34;</span><span class=o>,</span><span class=s>&#34;pixel753&#34;</span><span class=o>,</span><span class=s>&#34;pixel754&#34;</span><span class=o>,</span><span class=s>&#34;pixel755&#34;</span><span class=o>,</span><span class=s>&#34;pixel756&#34;</span><span class=o>,</span><span class=s>&#34;pixel757&#34;</span><span class=o>,</span><span class=s>&#34;pixel758&#34;</span><span class=o>,</span><span class=s>&#34;pixel759&#34;</span><span class=o>,</span><span class=s>&#34;pixel760&#34;</span><span class=o>,</span><span class=s>&#34;pixel761&#34;</span><span class=o>,</span><span class=s>&#34;pixel762&#34;</span><span class=o>,</span><span class=s>&#34;pixel763&#34;</span><span class=o>,</span><span class=s>&#34;pixel764&#34;</span><span class=o>,</span><span class=s>&#34;pixel765&#34;</span><span class=o>,</span><span class=s>&#34;pixel766&#34;</span><span class=o>,</span><span class=s>&#34;pixel767&#34;</span><span class=o>,</span><span class=s>&#34;pixel768&#34;</span><span class=o>,</span><span class=s>&#34;pixel769&#34;</span><span class=o>,</span><span class=s>&#34;pixel770&#34;</span><span class=o>,</span><span class=s>&#34;pixel771&#34;</span><span class=o>,</span><span class=s>&#34;pixel772&#34;</span><span class=o>,</span><span class=s>&#34;pixel773&#34;</span><span class=o>,</span><span class=s>&#34;pixel774&#34;</span><span class=o>,</span><span class=s>&#34;pixel775&#34;</span><span class=o>,</span><span class=s>&#34;pixel776&#34;</span><span class=o>,</span><span class=s>&#34;pixel777&#34;</span><span class=o>,</span><span class=s>&#34;pixel778&#34;</span><span class=o>,</span><span class=s>&#34;pixel779&#34;</span><span class=o>,</span><span class=s>&#34;pixel780&#34;</span><span class=o>,</span><span class=s>&#34;pixel781&#34;</span><span class=o>,</span><span class=s>&#34;pixel782&#34;</span><span class=o>,</span><span class=s>&#34;pixel783&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>layers</span> <span class=k>=</span> <span class=nc>Array</span><span class=o>[</span><span class=kt>Int</span><span class=o>](</span><span class=n>features</span><span class=o>.</span><span class=n>length</span><span class=o>,</span> <span class=mi>784</span><span class=o>,</span> <span class=mi>800</span><span class=o>,</span> <span class=n>labels</span><span class=o>.</span><span class=n>length</span><span class=o>)</span>

<span class=n>train</span><span class=o>.</span><span class=n>persist</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=nc>StorageLevel</span><span class=o>.</span><span class=nc>MEMORY_ONLY</span><span class=o>)</span>
<span class=n>test</span><span class=o>.</span><span class=n>persist</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=nc>StorageLevel</span><span class=o>.</span><span class=nc>MEMORY_ONLY</span><span class=o>)</span>

<span class=n>train</span><span class=o>.</span><span class=n>count</span><span class=o>()</span>
<span class=n>test</span><span class=o>.</span><span class=n>count</span><span class=o>()</span>

<span class=k>val</span> <span class=n>assembler</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>VectorAssembler</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCols</span><span class=o>(</span><span class=n>features</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>stringIndexer</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>StringIndexer</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>label</span><span class=o>)</span>
  <span class=o>.</span><span class=n>fit</span><span class=o>(</span><span class=n>train</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>mlp</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>MultilayerPerceptronClassifier</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setLabelCol</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setFeaturesCol</span><span class=o>(</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setLayers</span><span class=o>(</span><span class=n>layers</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setSeed</span><span class=o>(</span><span class=mi>42L</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setBlockSize</span><span class=o>(</span><span class=mi>128</span><span class=o>)</span> <span class=c1>//default 128
</span><span class=c1></span>  <span class=o>.</span><span class=n>setMaxIter</span><span class=o>(</span><span class=mi>10000</span><span class=o>)</span> <span class=c1>//default 100
</span><span class=c1></span>  <span class=o>.</span><span class=n>setTol</span><span class=o>(</span><span class=mi>1</span><span class=n>e</span><span class=o>-</span><span class=mi>7</span><span class=o>)</span> <span class=c1>//default 1e-4
</span><span class=c1></span><span class=o>}</span>
<span class=k>val</span> <span class=n>indexToString</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>IndexToString</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>mlp</span><span class=o>.</span><span class=n>getPredictionCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setLabels</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>labels</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>pipeline</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>Pipeline</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setStages</span><span class=o>(</span><span class=nc>Array</span><span class=o>(</span><span class=n>assembler</span><span class=o>,</span> <span class=n>stringIndexer</span><span class=o>,</span> <span class=n>mlp</span><span class=o>,</span> <span class=n>indexToString</span><span class=o>))</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>model</span> <span class=k>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=n>fit</span><span class=o>(</span><span class=n>train</span><span class=o>)</span>
<span class=k>val</span> <span class=n>result</span> <span class=k>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>test</span><span class=o>)</span>

<span class=k>val</span> <span class=n>evaluator</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>MulticlassClassificationEvaluator</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setLabelCol</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setPredictionCol</span><span class=o>(</span><span class=n>mlp</span><span class=o>.</span><span class=n>getPredictionCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setMetricName</span><span class=o>(</span><span class=s>&#34;precision&#34;</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>precision</span> <span class=k>=</span> <span class=n>evaluator</span><span class=o>.</span><span class=n>evaluate</span><span class=o>(</span><span class=n>result</span><span class=o>)</span>

<span class=k>val</span> <span class=n>confusionMatrix</span> <span class=k>=</span> <span class=o>{</span>
  <span class=n>result</span><span class=o>.</span><span class=n>select</span><span class=o>(</span><span class=n>col</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>),</span> <span class=n>col</span><span class=o>(</span><span class=n>indexToString</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>))</span>
  <span class=o>.</span><span class=n>orderBy</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>groupBy</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>pivot</span><span class=o>(</span><span class=n>indexToString</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=n>labels</span><span class=o>)</span>
  <span class=o>.</span><span class=n>count</span>
<span class=o>}</span>

<span class=n>println</span><span class=o>(</span><span class=s>s&#34;Confusion Matrix (Vertical: Actual, Horizontal: Predicted):&#34;</span><span class=o>)</span>
<span class=n>confusionMatrix</span><span class=o>.</span><span class=n>show</span>

<span class=n>println</span><span class=o>(</span><span class=s>s&#34;Duration: </span><span class=si>${</span><span class=o>(</span><span class=nc>System</span><span class=o>.</span><span class=n>currentTimeMillis</span> <span class=o>-</span> <span class=n>timestampStart</span><span class=o>)</span><span class=si>}</span><span class=s> ms (~</span><span class=si>${</span><span class=o>(</span><span class=nc>System</span><span class=o>.</span><span class=n>currentTimeMillis</span> <span class=o>-</span> <span class=n>timestampStart</span><span class=o>)/</span><span class=mi>1000</span><span class=o>/</span><span class=mi>60</span><span class=si>}</span><span class=s> minutes)&#34;</span><span class=o>)</span>
<span class=n>println</span><span class=o>(</span><span class=s>s&#34;Precision: </span><span class=si>${</span><span class=n>precision</span><span class=si>}</span><span class=s>&#34;</span><span class=o>)</span></code></pre></div><p>The output shows that this vanilla implementation will result in approximately <code>0.971</code> precision.</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=nc>Duration</span><span class=k>:</span> <span class=err>15379777</span> <span class=kt>ms</span> <span class=o>(</span><span class=kt>~</span><span class=err>256</span> <span class=kt>minutes</span><span class=o>)</span>
<span class=kt>Precision:</span> <span class=err>0</span><span class=kt>.</span><span class=err>971</span></code></pre></div><p>I have also created confusion matrix which shows the correct label (on the vertical axis) and the predicted label (horizontal axis). The way to read this is that <code>12</code> values which are should be <code>7</code> have been incorrectly classified as <code>2</code>.</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>+-----+---+----+---+---+---+---+---+---+---+---+</span>
<span class=o>|</span><span class=n>label</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>
<span class=o>+-----+---+----+---+---+---+---+---+---+---+---+</span>
<span class=o>|</span>    <span class=mi>0</span><span class=o>|</span><span class=mi>971</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1125</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>997</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span> <span class=mi>14</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span><span class=mi>984</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>954</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span> <span class=mi>14</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>5</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span> <span class=mi>13</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span><span class=mi>853</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>6</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span><span class=mi>934</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>7</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span> <span class=mi>12</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>993</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span> <span class=mi>10</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>8</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span> <span class=mi>10</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span><span class=mi>935</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>9</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span> <span class=mi>10</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span><span class=mi>964</span><span class=o>|</span>
<span class=o>+-----+---+----+---+---+---+---+---+---+---+---+</span></code></pre></div><h3 id=3-0-feature-cleaning-error-rate-2-17>3.0 Feature Cleaning - Error rate: 2.17%</h3><p>The first change we will make to the base implementation is to clean up the features by simplifying the representation of the numbers. The best neural network implementation method for MNIST is from a paper titled <a href=http://arxiv.org/abs/1003.0358>Deep Big Simple Neural Nets Excel on Handwritten Digit Recognition</a> who apply a <a href=https://spark.apache.org/docs/latest/ml-features.html#binarizer>Binarizer</a> type approach with a threshold value of <code>127.5</code>. This means that any pixel which has a grayscale value of less than <code>127.5</code> will be <code>0.0</code> and anything above <code>127.5</code> will be a <code>1.0</code>. This should clean up any smearing or pixels outside the &lsquo;core&rsquo; of the digit.</p><p>In Apache Spark 2.0.0 the <code>Binarizer</code> transformer will accept <code>Double</code> input types but until then you will have to manually build Spark with <a href=https://mike.seddon.ca/a-better-binarizer-for-apache-spark-ml/>my modified Binarizer</a>. Add/Modify the following code:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>import</span> <span class=nn>org.apache.spark.ml.feature.</span><span class=o>{</span><span class=nc>VectorAssembler</span><span class=o>,</span><span class=nc>Binarizer</span><span class=o>,</span><span class=nc>StringIndexer</span><span class=o>,</span><span class=nc>IndexToString</span><span class=o>}</span>

<span class=k>val</span> <span class=n>binarizer</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>Binarizer</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setThreshold</span><span class=o>(</span><span class=mf>127.5</span><span class=o>)</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>mlp</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>MultilayerPerceptronClassifier</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setLabelCol</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setFeaturesCol</span><span class=o>(</span><span class=n>binarizer</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setLayers</span><span class=o>(</span><span class=n>layers</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setSeed</span><span class=o>(</span><span class=mi>42L</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setBlockSize</span><span class=o>(</span><span class=mi>128</span><span class=o>)</span> <span class=c1>//default 128
</span><span class=c1></span>  <span class=o>.</span><span class=n>setMaxIter</span><span class=o>(</span><span class=mi>10000</span><span class=o>)</span> <span class=c1>//default 100
</span><span class=c1></span>  <span class=o>.</span><span class=n>setTol</span><span class=o>(</span><span class=mi>1</span><span class=n>e</span><span class=o>-</span><span class=mi>7</span><span class=o>)</span> <span class=c1>//default 1e-4
</span><span class=c1></span><span class=o>}</span>

<span class=k>val</span> <span class=n>pipeline</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>Pipeline</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setStages</span><span class=o>(</span><span class=nc>Array</span><span class=o>(</span><span class=n>assembler</span><span class=o>,</span> <span class=n>binarizer</span><span class=o>,</span> <span class=n>stringIndexer</span><span class=o>,</span> <span class=n>mlp</span><span class=o>,</span> <span class=n>indexToString</span><span class=o>))</span>
<span class=o>}</span></code></pre></div><p>With this approach we have increased our precision by 0.73% which may not sound much but would be 7,300 if we were to try to recognise 1 million digits - not insignificant.</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span><span class=n>label</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>   <span class=mi>7</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span>    <span class=mi>0</span><span class=o>|</span><span class=mi>971</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1127</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>1007</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>990</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>956</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span> <span class=mi>13</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span><span class=mi>870</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>6</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span><span class=mi>933</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>7</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1003</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>8</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span><span class=mi>949</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>9</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span><span class=mi>977</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>

<span class=nc>Duration</span><span class=k>:</span> <span class=err>13986596</span> <span class=kt>ms</span> <span class=o>(</span><span class=kt>~</span><span class=err>233</span> <span class=kt>minutes</span><span class=o>)</span>
<span class=kt>Precision:</span> <span class=err>0</span><span class=kt>.</span><span class=err>9783</span></code></pre></div><h3 id=4-0-feature-engineering-by-rotation-error-rate-1-99>4.0 Feature Engineering by Rotation - Error rate: 1.99%</h3><p>As we are still a long way from the best in the world MNIST neural network performance we need to try something more radical: engineering our own features to give the <code>MultilayerPerceptronClassifier</code> more data to learn from. In the MNIST entries a lot of teams create additional features by performing &lsquo;elastic distortions&rsquo; which appears to be used quite broadly when talking about the MNIST challenge ranging from simple rotations to more complex distortion based approaches. The obvious downside to this is that each <code>MultilayerPerceptronClassifier</code> iteration will now have to process more data and so each iteration will take longer.</p><p>The first we are going to try is to apply simple rotation like the winning entry of <code>+15°</code> and <code>-15°</code> and we are doing this with another custom transformer: <a href=https://mike.seddon.ca/affinetransform-transformer-for-apache-spark-ml/>AffineTransform</a>.</p><p>Now this is a bit different to a normal pipeline as we only want to apply the <code>AffineTransform</code> transformer to the <code>train</code> set not both <code>train</code> and <code>test</code> which means we need to separate the <code>VectorAssembler</code> and the two <code>AffineTransform</code> stages from the pipeline and <code>unionAll</code> the results:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>val</span> <span class=n>assembler</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>VectorAssembler</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCols</span><span class=o>(</span><span class=n>features</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setOutputCol</span><span class=o>(</span><span class=n>featuresLabel</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>affineTransformRotateNeg</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>AffineTransform</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setWidth</span><span class=o>(</span><span class=mi>28</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setHeight</span><span class=o>(</span><span class=mi>28</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setOperation</span><span class=o>(</span><span class=s>&#34;rotate&#34;</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setFactor</span><span class=o>(-</span><span class=mi>15</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>affineTransformRotatePos</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>AffineTransform</span><span class=o>()</span><span class=n>t</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setWidth</span><span class=o>(</span><span class=mi>28</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setHeight</span><span class=o>(</span><span class=mi>28</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setOperation</span><span class=o>(</span><span class=s>&#34;rotate&#34;</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setFactor</span><span class=o>(</span><span class=mi>15</span><span class=o>)</span>
<span class=o>}</span>
<span class=k>val</span> <span class=n>assemblerDF</span> <span class=k>=</span> <span class=n>assembler</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>train</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
<span class=k>val</span> <span class=n>affineTransformRotateNegDF</span> <span class=k>=</span> <span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>assemblerDF</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>).</span><span class=n>withColumnRenamed</span><span class=o>(</span><span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=s>&#34;features&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>affineTransformRotatePosDF</span> <span class=k>=</span> <span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>assemblerDF</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>).</span><span class=n>withColumnRenamed</span><span class=o>(</span><span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=s>&#34;features&#34;</span><span class=o>)</span>

<span class=k>val</span> <span class=n>trainDF</span> <span class=k>=</span> <span class=n>assemblerDF</span><span class=o>.</span><span class=n>unionAll</span><span class=o>(</span><span class=n>affineTransformRotateNegDF</span><span class=o>).</span><span class=n>unionAll</span><span class=o>(</span><span class=n>affineTransformRotatePosDF</span><span class=o>)</span>
<span class=k>val</span> <span class=n>testDF</span> <span class=k>=</span> <span class=n>assembler</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>test</span><span class=o>)</span>

<span class=n>trainDF</span><span class=o>.</span><span class=n>persist</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=nc>StorageLevel</span><span class=o>.</span><span class=nc>MEMORY_ONLY</span><span class=o>)</span>
<span class=n>testDF</span><span class=o>.</span><span class=n>persist</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=nc>StorageLevel</span><span class=o>.</span><span class=nc>MEMORY_ONLY</span><span class=o>)</span>

<span class=n>trainDF</span><span class=o>.</span><span class=n>count</span><span class=o>()</span>
<span class=n>testDF</span><span class=o>.</span><span class=n>count</span><span class=o>()</span></code></pre></div><p>Modify the <code>Binarizer</code>, <code>Pipeline</code>, <code>model</code> and <code>result</code> accordingly:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>val</span> <span class=n>binarizer</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>Binarizer</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCol</span><span class=o>(</span><span class=n>featuresLabel</span><span class=o>)</span>
  <span class=o>.</span><span class=n>setThreshold</span><span class=o>(</span><span class=mf>127.5</span><span class=o>)</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>pipeline</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>Pipeline</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setStages</span><span class=o>(</span><span class=nc>Array</span><span class=o>(</span><span class=n>binarizer</span><span class=o>,</span> <span class=n>stringIndexer</span><span class=o>,</span> <span class=n>mlp</span><span class=o>,</span> <span class=n>indexToString</span><span class=o>))</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>model</span> <span class=k>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=n>fit</span><span class=o>(</span><span class=n>trainDF</span><span class=o>)</span>
<span class=k>val</span> <span class=n>result</span> <span class=k>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF</span><span class=o>)</span></code></pre></div><p>The result:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span><span class=n>label</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>   <span class=mi>7</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span>    <span class=mi>0</span><span class=o>|</span><span class=mi>970</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1128</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>1012</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span><span class=mi>991</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>8</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>966</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>874</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>6</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span><span class=mi>937</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>7</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1001</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>8</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span><span class=mi>946</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>9</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span> <span class=mi>13</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>7</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span><span class=mi>976</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>

<span class=nc>Duration</span><span class=k>:</span> <span class=err>52917415</span> <span class=kt>ms</span> <span class=o>(</span><span class=kt>~</span><span class=err>881</span> <span class=kt>minutes</span><span class=o>)</span>
<span class=kt>Precision:</span> <span class=err>0</span><span class=kt>.</span><span class=err>9801</span></code></pre></div><h3 id=5-0-decreasing-the-tolerance-error-rate-1-97>5.0 Decreasing the Tolerance - Error Rate: 1.97%</h3><p>One of the parameters of the MultilayerPerceptronClassifier is the &lsquo;convergence tolerance for iterative algorithms&rsquo;. By decreasing this value we would expect to see the model to take longer to build but potentially be more accurate. By doing this change the runtime did increase by <code>3.40%</code> but the error rate also decreased by <code>0.02%</code>.</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span><span class=n>label</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>   <span class=mi>7</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span>    <span class=mi>0</span><span class=o>|</span><span class=mi>969</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1128</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>1011</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span><span class=mi>990</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>964</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>871</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>6</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span><span class=mi>943</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>7</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1002</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span> <span class=mi>11</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>8</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span><span class=mi>949</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>9</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span> <span class=mi>12</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>8</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span><span class=mi>976</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>

<span class=nc>Duration</span><span class=k>:</span> <span class=err>54716944</span> <span class=kt>ms</span> <span class=o>(</span><span class=kt>~</span><span class=err>911</span> <span class=kt>minutes</span><span class=o>)</span>
<span class=kt>Precision:</span> <span class=err>0</span><span class=kt>.</span><span class=err>9803</span></code></pre></div><h3 id=6-0-test-data-manipulation-error-rate-1-74>6.0 Test Data Manipulation - Error Rate: 1.74%</h3><p>My next idea was to see if I could try the rotation feature creation on the reserved <code>test</code> data set then use a basic consensus algorithm to choose the most common prediction (this is similar to ensembling).</p><p>The workflow is:</p><ul><li>Take the reserved <code>test</code> dataset.</li><li>Create a <code>+15°</code> AffineTransform rotated <code>test</code> dataset.</li><li>Create a <code>-15°</code> AffineTransform rotated <code>test</code> dataset.</li><li>Calculate predictions against all three datasets independently.</li><li>Union the three datasets.</li><li>Use a <code>groupBy</code> and <code>Window</code> function to select the most frequent <code>prediction</code> value. The best case is full consensus (<code>3</code>: all datasets produce same <code>prediction</code>) worst case (<code>1</code>: all three datasets have different <code>prediction</code>).</li><li>Run standard evaluator.</li></ul><p>Here are the changes:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>import</span> <span class=nn>org.apache.spark.sql.expressions.Window</span>
<span class=k>import</span> <span class=nn>org.apache.spark.sql.functions.</span><span class=o>{</span><span class=n>rowNumber</span><span class=o>,</span> <span class=n>desc</span><span class=o>}</span>

<span class=k>val</span> <span class=n>testDF1</span> <span class=k>=</span> <span class=n>assembler</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>test</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
<span class=k>val</span> <span class=n>testDF2</span> <span class=k>=</span> <span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF1</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>).</span><span class=n>withColumnRenamed</span><span class=o>(</span><span class=n>affineTransformRotateNeg</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=s>&#34;features&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>testDF3</span> <span class=k>=</span> <span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF1</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span><span class=n>label</span><span class=o>,</span><span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>).</span><span class=n>withColumnRenamed</span><span class=o>(</span><span class=n>affineTransformRotatePos</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=s>&#34;features&#34;</span><span class=o>)</span>


<span class=k>val</span> <span class=n>result1</span> <span class=k>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF1</span><span class=o>)</span>
<span class=k>val</span> <span class=n>result2</span> <span class=k>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF2</span><span class=o>)</span>
<span class=k>val</span> <span class=n>result3</span> <span class=k>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>testDF3</span><span class=o>)</span>

<span class=k>val</span> <span class=n>resultDF</span> <span class=k>=</span> <span class=n>result1</span><span class=o>.</span><span class=n>unionAll</span><span class=o>(</span><span class=n>result2</span><span class=o>).</span><span class=n>unionAll</span><span class=o>(</span><span class=n>result3</span><span class=o>)</span>

<span class=k>val</span> <span class=n>w</span> <span class=k>=</span> <span class=nc>Window</span><span class=o>.</span><span class=n>partitionBy</span><span class=o>(</span><span class=n>$</span><span class=s>&#34;id&#34;</span><span class=o>).</span><span class=n>orderBy</span><span class=o>(</span><span class=n>desc</span><span class=o>(</span><span class=s>&#34;count&#34;</span><span class=o>))</span>

<span class=k>val</span> <span class=n>consensusDF</span> <span class=k>=</span> <span class=o>{</span>
  <span class=n>resultDF</span><span class=o>.</span><span class=n>groupBy</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>,</span> <span class=n>label</span><span class=o>,</span> <span class=n>stringIndexer</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span> <span class=n>mlp</span><span class=o>.</span><span class=n>getPredictionCol</span><span class=o>,</span> <span class=n>indexToString</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>count</span><span class=o>()</span>
  <span class=o>.</span><span class=n>withColumn</span><span class=o>(</span><span class=s>&#34;rowNumber&#34;</span><span class=o>,</span> <span class=n>rowNumber</span><span class=o>.</span><span class=n>over</span><span class=o>(</span><span class=n>w</span><span class=o>))</span>
  <span class=o>.</span><span class=n>where</span><span class=o>(</span><span class=n>$</span><span class=s>&#34;rowNumber&#34;</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>precision</span> <span class=k>=</span> <span class=n>evaluator</span><span class=o>.</span><span class=n>evaluate</span><span class=o>(</span><span class=n>consensusDF</span><span class=o>)</span>

<span class=k>val</span> <span class=n>confusionMatrix</span> <span class=k>=</span> <span class=o>{</span>
  <span class=n>consensusDF</span><span class=o>.</span><span class=n>select</span><span class=o>(</span><span class=n>col</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>),</span> <span class=n>col</span><span class=o>(</span><span class=n>indexToString</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>))</span>
  <span class=o>.</span><span class=n>orderBy</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>groupBy</span><span class=o>(</span><span class=n>stringIndexer</span><span class=o>.</span><span class=n>getInputCol</span><span class=o>)</span>
  <span class=o>.</span><span class=n>pivot</span><span class=o>(</span><span class=n>indexToString</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>,</span><span class=n>labels</span><span class=o>)</span>
  <span class=o>.</span><span class=n>count</span>
<span class=o>}</span></code></pre></div><p>This results in the best score yet:</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span><span class=n>label</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>   <span class=mi>7</span><span class=o>|</span>  <span class=mi>8</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>
<span class=o>|</span>    <span class=mi>0</span><span class=o>|</span><span class=mi>967</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>1129</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>2</span><span class=o>|</span><span class=mi>1017</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span><span class=mi>995</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>962</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>5</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>7</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span><span class=mi>874</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>6</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>946</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>7</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span>   <span class=mi>5</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span><span class=mi>1005</span><span class=o>|</span>  <span class=mi>2</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>8</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>0</span><span class=o>|</span>   <span class=mi>6</span><span class=o>|</span>  <span class=mi>6</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>  <span class=mi>4</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span><span class=mi>950</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span>
<span class=o>|</span>    <span class=mi>9</span><span class=o>|</span>  <span class=mi>0</span><span class=o>|</span>   <span class=mi>3</span><span class=o>|</span>   <span class=mi>1</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>9</span><span class=o>|</span>  <span class=mi>3</span><span class=o>|</span>  <span class=mi>1</span><span class=o>|</span>   <span class=mi>4</span><span class=o>|</span>  <span class=mi>5</span><span class=o>|</span><span class=mi>980</span><span class=o>|</span>
<span class=o>+-----+---+----+----+---+---+---+---+----+---+---+</span>

<span class=nc>Duration</span><span class=k>:</span> <span class=err>58163956</span> <span class=kt>ms</span> <span class=o>(</span><span class=kt>~</span><span class=err>969</span> <span class=kt>minutes</span><span class=o>)</span>
<span class=kt>Precision:</span> <span class=err>0</span><span class=kt>.</span><span class=err>9826</span></code></pre></div><h3 id=7-0-sparkling-water-h2o-spark>7.0 Sparkling Water: H2O + Spark</h3><p>After reaching a bit of a dead-end with Spark&rsquo;s MultiLayerPerceptron Classifier I thought it would be nice to test H2O running on Spark called <a href=http://www.h2o.ai/product/sparkling-water/>Sparkling Water</a> as they have achieved <a href=http://blog.h2o.ai/2015/02/deep-learning-performance/>extremely good performance</a> on the MNIST dataset. <strong>Note: I have not managed to achieve the results they have reported on their blog yet so I am not going to include the H2O error rate - this just demonstrates how to run Sparkling Water over the same dataset.</strong></p><p>Honestly, I don&rsquo;t really want this solution to win as you can see in the code below that whilst the API has been built to allow H2O to run with a Spark backend it is not integrated in the way that Spark ML is. I also think that having to install different packages produced by many different parties takes away from the clean, single ecosystem that Apache Spark provides.</p><p>Hopefully the Spark developers can reach feature and performance parity so that Spark ML can be the one framework to rule them all and we won&rsquo;t have to depend on external packages - but at the end of the day it is the quality of the model which counts.</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>import</span> <span class=nn>org.apache.spark.h2o._</span>
<span class=k>import</span> <span class=nn>water.Key</span>
<span class=k>import</span> <span class=nn>_root_.hex.deeplearning.DeepLearning</span>
<span class=k>import</span> <span class=nn>_root_.hex.deeplearning.DeepLearningParameters</span>
<span class=k>import</span> <span class=nn>_root_.hex.deeplearning.DeepLearningParameters.Activation</span>
<span class=k>import</span> <span class=nn>_root_.hex.deeplearning.DeepLearningParameters.Loss</span>
<span class=k>val</span> <span class=n>h2oContext</span> <span class=k>=</span> <span class=n>H2OContext</span><span class=o>.</span><span class=n>getOrCreate</span><span class=o>(</span><span class=n>sc</span><span class=o>).</span><span class=n>start</span><span class=o>()</span>
<span class=k>import</span> <span class=nn>h2oContext._</span>

<span class=k>import</span> <span class=nn>org.apache.spark.ml.feature.</span><span class=o>{</span><span class=nc>VectorAssembler</span><span class=o>}</span>

<span class=k>val</span> <span class=n>timestampStart</span><span class=k>:</span> <span class=kt>Long</span> <span class=o>=</span> <span class=nc>System</span><span class=o>.</span><span class=n>currentTimeMillis</span>

<span class=k>val</span> <span class=n>train</span> <span class=k>=</span> <span class=n>sqlContext</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>load</span><span class=o>(</span><span class=s>&#34;/home/mike/data/mnist/train.parquet&#34;</span><span class=o>)</span>
<span class=k>val</span> <span class=n>test</span> <span class=k>=</span> <span class=n>sqlContext</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>load</span><span class=o>(</span><span class=s>&#34;/home/mike/data/mnist/test.parquet&#34;</span><span class=o>)</span>

<span class=k>val</span> <span class=n>label</span> <span class=k>=</span> <span class=s>&#34;label&#34;</span>
<span class=k>val</span> <span class=n>features</span> <span class=k>=</span> <span class=nc>Array</span><span class=o>(</span><span class=s>&#34;pixel0&#34;</span><span class=o>,</span><span class=s>&#34;pixel1&#34;</span><span class=o>,</span><span class=s>&#34;pixel2&#34;</span><span class=o>,</span><span class=s>&#34;pixel3&#34;</span><span class=o>,</span><span class=s>&#34;pixel4&#34;</span><span class=o>,</span><span class=s>&#34;pixel5&#34;</span><span class=o>,</span><span class=s>&#34;pixel6&#34;</span><span class=o>,</span><span class=s>&#34;pixel7&#34;</span><span class=o>,</span><span class=s>&#34;pixel8&#34;</span><span class=o>,</span><span class=s>&#34;pixel9&#34;</span><span class=o>,</span><span class=s>&#34;pixel10&#34;</span><span class=o>,</span><span class=s>&#34;pixel11&#34;</span><span class=o>,</span><span class=s>&#34;pixel12&#34;</span><span class=o>,</span><span class=s>&#34;pixel13&#34;</span><span class=o>,</span><span class=s>&#34;pixel14&#34;</span><span class=o>,</span><span class=s>&#34;pixel15&#34;</span><span class=o>,</span><span class=s>&#34;pixel16&#34;</span><span class=o>,</span><span class=s>&#34;pixel17&#34;</span><span class=o>,</span><span class=s>&#34;pixel18&#34;</span><span class=o>,</span><span class=s>&#34;pixel19&#34;</span><span class=o>,</span><span class=s>&#34;pixel20&#34;</span><span class=o>,</span><span class=s>&#34;pixel21&#34;</span><span class=o>,</span><span class=s>&#34;pixel22&#34;</span><span class=o>,</span><span class=s>&#34;pixel23&#34;</span><span class=o>,</span><span class=s>&#34;pixel24&#34;</span><span class=o>,</span><span class=s>&#34;pixel25&#34;</span><span class=o>,</span><span class=s>&#34;pixel26&#34;</span><span class=o>,</span><span class=s>&#34;pixel27&#34;</span><span class=o>,</span><span class=s>&#34;pixel28&#34;</span><span class=o>,</span><span class=s>&#34;pixel29&#34;</span><span class=o>,</span><span class=s>&#34;pixel30&#34;</span><span class=o>,</span><span class=s>&#34;pixel31&#34;</span><span class=o>,</span><span class=s>&#34;pixel32&#34;</span><span class=o>,</span><span class=s>&#34;pixel33&#34;</span><span class=o>,</span><span class=s>&#34;pixel34&#34;</span><span class=o>,</span><span class=s>&#34;pixel35&#34;</span><span class=o>,</span><span class=s>&#34;pixel36&#34;</span><span class=o>,</span><span class=s>&#34;pixel37&#34;</span><span class=o>,</span><span class=s>&#34;pixel38&#34;</span><span class=o>,</span><span class=s>&#34;pixel39&#34;</span><span class=o>,</span><span class=s>&#34;pixel40&#34;</span><span class=o>,</span><span class=s>&#34;pixel41&#34;</span><span class=o>,</span><span class=s>&#34;pixel42&#34;</span><span class=o>,</span><span class=s>&#34;pixel43&#34;</span><span class=o>,</span><span class=s>&#34;pixel44&#34;</span><span class=o>,</span><span class=s>&#34;pixel45&#34;</span><span class=o>,</span><span class=s>&#34;pixel46&#34;</span><span class=o>,</span><span class=s>&#34;pixel47&#34;</span><span class=o>,</span><span class=s>&#34;pixel48&#34;</span><span class=o>,</span><span class=s>&#34;pixel49&#34;</span><span class=o>,</span><span class=s>&#34;pixel50&#34;</span><span class=o>,</span><span class=s>&#34;pixel51&#34;</span><span class=o>,</span><span class=s>&#34;pixel52&#34;</span><span class=o>,</span><span class=s>&#34;pixel53&#34;</span><span class=o>,</span><span class=s>&#34;pixel54&#34;</span><span class=o>,</span><span class=s>&#34;pixel55&#34;</span><span class=o>,</span><span class=s>&#34;pixel56&#34;</span><span class=o>,</span><span class=s>&#34;pixel57&#34;</span><span class=o>,</span><span class=s>&#34;pixel58&#34;</span><span class=o>,</span><span class=s>&#34;pixel59&#34;</span><span class=o>,</span><span class=s>&#34;pixel60&#34;</span><span class=o>,</span><span class=s>&#34;pixel61&#34;</span><span class=o>,</span><span class=s>&#34;pixel62&#34;</span><span class=o>,</span><span class=s>&#34;pixel63&#34;</span><span class=o>,</span><span class=s>&#34;pixel64&#34;</span><span class=o>,</span><span class=s>&#34;pixel65&#34;</span><span class=o>,</span><span class=s>&#34;pixel66&#34;</span><span class=o>,</span><span class=s>&#34;pixel67&#34;</span><span class=o>,</span><span class=s>&#34;pixel68&#34;</span><span class=o>,</span><span class=s>&#34;pixel69&#34;</span><span class=o>,</span><span class=s>&#34;pixel70&#34;</span><span class=o>,</span><span class=s>&#34;pixel71&#34;</span><span class=o>,</span><span class=s>&#34;pixel72&#34;</span><span class=o>,</span><span class=s>&#34;pixel73&#34;</span><span class=o>,</span><span class=s>&#34;pixel74&#34;</span><span class=o>,</span><span class=s>&#34;pixel75&#34;</span><span class=o>,</span><span class=s>&#34;pixel76&#34;</span><span class=o>,</span><span class=s>&#34;pixel77&#34;</span><span class=o>,</span><span class=s>&#34;pixel78&#34;</span><span class=o>,</span><span class=s>&#34;pixel79&#34;</span><span class=o>,</span><span class=s>&#34;pixel80&#34;</span><span class=o>,</span><span class=s>&#34;pixel81&#34;</span><span class=o>,</span><span class=s>&#34;pixel82&#34;</span><span class=o>,</span><span class=s>&#34;pixel83&#34;</span><span class=o>,</span><span class=s>&#34;pixel84&#34;</span><span class=o>,</span><span class=s>&#34;pixel85&#34;</span><span class=o>,</span><span class=s>&#34;pixel86&#34;</span><span class=o>,</span><span class=s>&#34;pixel87&#34;</span><span class=o>,</span><span class=s>&#34;pixel88&#34;</span><span class=o>,</span><span class=s>&#34;pixel89&#34;</span><span class=o>,</span><span class=s>&#34;pixel90&#34;</span><span class=o>,</span><span class=s>&#34;pixel91&#34;</span><span class=o>,</span><span class=s>&#34;pixel92&#34;</span><span class=o>,</span><span class=s>&#34;pixel93&#34;</span><span class=o>,</span><span class=s>&#34;pixel94&#34;</span><span class=o>,</span><span class=s>&#34;pixel95&#34;</span><span class=o>,</span><span class=s>&#34;pixel96&#34;</span><span class=o>,</span><span class=s>&#34;pixel97&#34;</span><span class=o>,</span><span class=s>&#34;pixel98&#34;</span><span class=o>,</span><span class=s>&#34;pixel99&#34;</span><span class=o>,</span><span class=s>&#34;pixel100&#34;</span><span class=o>,</span><span class=s>&#34;pixel101&#34;</span><span class=o>,</span><span class=s>&#34;pixel102&#34;</span><span class=o>,</span><span class=s>&#34;pixel103&#34;</span><span class=o>,</span><span class=s>&#34;pixel104&#34;</span><span class=o>,</span><span class=s>&#34;pixel105&#34;</span><span class=o>,</span><span class=s>&#34;pixel106&#34;</span><span class=o>,</span><span class=s>&#34;pixel107&#34;</span><span class=o>,</span><span class=s>&#34;pixel108&#34;</span><span class=o>,</span><span class=s>&#34;pixel109&#34;</span><span class=o>,</span><span class=s>&#34;pixel110&#34;</span><span class=o>,</span><span class=s>&#34;pixel111&#34;</span><span class=o>,</span><span class=s>&#34;pixel112&#34;</span><span class=o>,</span><span class=s>&#34;pixel113&#34;</span><span class=o>,</span><span class=s>&#34;pixel114&#34;</span><span class=o>,</span><span class=s>&#34;pixel115&#34;</span><span class=o>,</span><span class=s>&#34;pixel116&#34;</span><span class=o>,</span><span class=s>&#34;pixel117&#34;</span><span class=o>,</span><span class=s>&#34;pixel118&#34;</span><span class=o>,</span><span class=s>&#34;pixel119&#34;</span><span class=o>,</span><span class=s>&#34;pixel120&#34;</span><span class=o>,</span><span class=s>&#34;pixel121&#34;</span><span class=o>,</span><span class=s>&#34;pixel122&#34;</span><span class=o>,</span><span class=s>&#34;pixel123&#34;</span><span class=o>,</span><span class=s>&#34;pixel124&#34;</span><span class=o>,</span><span class=s>&#34;pixel125&#34;</span><span class=o>,</span><span class=s>&#34;pixel126&#34;</span><span class=o>,</span><span class=s>&#34;pixel127&#34;</span><span class=o>,</span><span class=s>&#34;pixel128&#34;</span><span class=o>,</span><span class=s>&#34;pixel129&#34;</span><span class=o>,</span><span class=s>&#34;pixel130&#34;</span><span class=o>,</span><span class=s>&#34;pixel131&#34;</span><span class=o>,</span><span class=s>&#34;pixel132&#34;</span><span class=o>,</span><span class=s>&#34;pixel133&#34;</span><span class=o>,</span><span class=s>&#34;pixel134&#34;</span><span class=o>,</span><span class=s>&#34;pixel135&#34;</span><span class=o>,</span><span class=s>&#34;pixel136&#34;</span><span class=o>,</span><span class=s>&#34;pixel137&#34;</span><span class=o>,</span><span class=s>&#34;pixel138&#34;</span><span class=o>,</span><span class=s>&#34;pixel139&#34;</span><span class=o>,</span><span class=s>&#34;pixel140&#34;</span><span class=o>,</span><span class=s>&#34;pixel141&#34;</span><span class=o>,</span><span class=s>&#34;pixel142&#34;</span><span class=o>,</span><span class=s>&#34;pixel143&#34;</span><span class=o>,</span><span class=s>&#34;pixel144&#34;</span><span class=o>,</span><span class=s>&#34;pixel145&#34;</span><span class=o>,</span><span class=s>&#34;pixel146&#34;</span><span class=o>,</span><span class=s>&#34;pixel147&#34;</span><span class=o>,</span><span class=s>&#34;pixel148&#34;</span><span class=o>,</span><span class=s>&#34;pixel149&#34;</span><span class=o>,</span><span class=s>&#34;pixel150&#34;</span><span class=o>,</span><span class=s>&#34;pixel151&#34;</span><span class=o>,</span><span class=s>&#34;pixel152&#34;</span><span class=o>,</span><span class=s>&#34;pixel153&#34;</span><span class=o>,</span><span class=s>&#34;pixel154&#34;</span><span class=o>,</span><span class=s>&#34;pixel155&#34;</span><span class=o>,</span><span class=s>&#34;pixel156&#34;</span><span class=o>,</span><span class=s>&#34;pixel157&#34;</span><span class=o>,</span><span class=s>&#34;pixel158&#34;</span><span class=o>,</span><span class=s>&#34;pixel159&#34;</span><span class=o>,</span><span class=s>&#34;pixel160&#34;</span><span class=o>,</span><span class=s>&#34;pixel161&#34;</span><span class=o>,</span><span class=s>&#34;pixel162&#34;</span><span class=o>,</span><span class=s>&#34;pixel163&#34;</span><span class=o>,</span><span class=s>&#34;pixel164&#34;</span><span class=o>,</span><span class=s>&#34;pixel165&#34;</span><span class=o>,</span><span class=s>&#34;pixel166&#34;</span><span class=o>,</span><span class=s>&#34;pixel167&#34;</span><span class=o>,</span><span class=s>&#34;pixel168&#34;</span><span class=o>,</span><span class=s>&#34;pixel169&#34;</span><span class=o>,</span><span class=s>&#34;pixel170&#34;</span><span class=o>,</span><span class=s>&#34;pixel171&#34;</span><span class=o>,</span><span class=s>&#34;pixel172&#34;</span><span class=o>,</span><span class=s>&#34;pixel173&#34;</span><span class=o>,</span><span class=s>&#34;pixel174&#34;</span><span class=o>,</span><span class=s>&#34;pixel175&#34;</span><span class=o>,</span><span class=s>&#34;pixel176&#34;</span><span class=o>,</span><span class=s>&#34;pixel177&#34;</span><span class=o>,</span><span class=s>&#34;pixel178&#34;</span><span class=o>,</span><span class=s>&#34;pixel179&#34;</span><span class=o>,</span><span class=s>&#34;pixel180&#34;</span><span class=o>,</span><span class=s>&#34;pixel181&#34;</span><span class=o>,</span><span class=s>&#34;pixel182&#34;</span><span class=o>,</span><span class=s>&#34;pixel183&#34;</span><span class=o>,</span><span class=s>&#34;pixel184&#34;</span><span class=o>,</span><span class=s>&#34;pixel185&#34;</span><span class=o>,</span><span class=s>&#34;pixel186&#34;</span><span class=o>,</span><span class=s>&#34;pixel187&#34;</span><span class=o>,</span><span class=s>&#34;pixel188&#34;</span><span class=o>,</span><span class=s>&#34;pixel189&#34;</span><span class=o>,</span><span class=s>&#34;pixel190&#34;</span><span class=o>,</span><span class=s>&#34;pixel191&#34;</span><span class=o>,</span><span class=s>&#34;pixel192&#34;</span><span class=o>,</span><span class=s>&#34;pixel193&#34;</span><span class=o>,</span><span class=s>&#34;pixel194&#34;</span><span class=o>,</span><span class=s>&#34;pixel195&#34;</span><span class=o>,</span><span class=s>&#34;pixel196&#34;</span><span class=o>,</span><span class=s>&#34;pixel197&#34;</span><span class=o>,</span><span class=s>&#34;pixel198&#34;</span><span class=o>,</span><span class=s>&#34;pixel199&#34;</span><span class=o>,</span><span class=s>&#34;pixel200&#34;</span><span class=o>,</span><span class=s>&#34;pixel201&#34;</span><span class=o>,</span><span class=s>&#34;pixel202&#34;</span><span class=o>,</span><span class=s>&#34;pixel203&#34;</span><span class=o>,</span><span class=s>&#34;pixel204&#34;</span><span class=o>,</span><span class=s>&#34;pixel205&#34;</span><span class=o>,</span><span class=s>&#34;pixel206&#34;</span><span class=o>,</span><span class=s>&#34;pixel207&#34;</span><span class=o>,</span><span class=s>&#34;pixel208&#34;</span><span class=o>,</span><span class=s>&#34;pixel209&#34;</span><span class=o>,</span><span class=s>&#34;pixel210&#34;</span><span class=o>,</span><span class=s>&#34;pixel211&#34;</span><span class=o>,</span><span class=s>&#34;pixel212&#34;</span><span class=o>,</span><span class=s>&#34;pixel213&#34;</span><span class=o>,</span><span class=s>&#34;pixel214&#34;</span><span class=o>,</span><span class=s>&#34;pixel215&#34;</span><span class=o>,</span><span class=s>&#34;pixel216&#34;</span><span class=o>,</span><span class=s>&#34;pixel217&#34;</span><span class=o>,</span><span class=s>&#34;pixel218&#34;</span><span class=o>,</span><span class=s>&#34;pixel219&#34;</span><span class=o>,</span><span class=s>&#34;pixel220&#34;</span><span class=o>,</span><span class=s>&#34;pixel221&#34;</span><span class=o>,</span><span class=s>&#34;pixel222&#34;</span><span class=o>,</span><span class=s>&#34;pixel223&#34;</span><span class=o>,</span><span class=s>&#34;pixel224&#34;</span><span class=o>,</span><span class=s>&#34;pixel225&#34;</span><span class=o>,</span><span class=s>&#34;pixel226&#34;</span><span class=o>,</span><span class=s>&#34;pixel227&#34;</span><span class=o>,</span><span class=s>&#34;pixel228&#34;</span><span class=o>,</span><span class=s>&#34;pixel229&#34;</span><span class=o>,</span><span class=s>&#34;pixel230&#34;</span><span class=o>,</span><span class=s>&#34;pixel231&#34;</span><span class=o>,</span><span class=s>&#34;pixel232&#34;</span><span class=o>,</span><span class=s>&#34;pixel233&#34;</span><span class=o>,</span><span class=s>&#34;pixel234&#34;</span><span class=o>,</span><span class=s>&#34;pixel235&#34;</span><span class=o>,</span><span class=s>&#34;pixel236&#34;</span><span class=o>,</span><span class=s>&#34;pixel237&#34;</span><span class=o>,</span><span class=s>&#34;pixel238&#34;</span><span class=o>,</span><span class=s>&#34;pixel239&#34;</span><span class=o>,</span><span class=s>&#34;pixel240&#34;</span><span class=o>,</span><span class=s>&#34;pixel241&#34;</span><span class=o>,</span><span class=s>&#34;pixel242&#34;</span><span class=o>,</span><span class=s>&#34;pixel243&#34;</span><span class=o>,</span><span class=s>&#34;pixel244&#34;</span><span class=o>,</span><span class=s>&#34;pixel245&#34;</span><span class=o>,</span><span class=s>&#34;pixel246&#34;</span><span class=o>,</span><span class=s>&#34;pixel247&#34;</span><span class=o>,</span><span class=s>&#34;pixel248&#34;</span><span class=o>,</span><span class=s>&#34;pixel249&#34;</span><span class=o>,</span><span class=s>&#34;pixel250&#34;</span><span class=o>,</span><span class=s>&#34;pixel251&#34;</span><span class=o>,</span><span class=s>&#34;pixel252&#34;</span><span class=o>,</span><span class=s>&#34;pixel253&#34;</span><span class=o>,</span><span class=s>&#34;pixel254&#34;</span><span class=o>,</span><span class=s>&#34;pixel255&#34;</span><span class=o>,</span><span class=s>&#34;pixel256&#34;</span><span class=o>,</span><span class=s>&#34;pixel257&#34;</span><span class=o>,</span><span class=s>&#34;pixel258&#34;</span><span class=o>,</span><span class=s>&#34;pixel259&#34;</span><span class=o>,</span><span class=s>&#34;pixel260&#34;</span><span class=o>,</span><span class=s>&#34;pixel261&#34;</span><span class=o>,</span><span class=s>&#34;pixel262&#34;</span><span class=o>,</span><span class=s>&#34;pixel263&#34;</span><span class=o>,</span><span class=s>&#34;pixel264&#34;</span><span class=o>,</span><span class=s>&#34;pixel265&#34;</span><span class=o>,</span><span class=s>&#34;pixel266&#34;</span><span class=o>,</span><span class=s>&#34;pixel267&#34;</span><span class=o>,</span><span class=s>&#34;pixel268&#34;</span><span class=o>,</span><span class=s>&#34;pixel269&#34;</span><span class=o>,</span><span class=s>&#34;pixel270&#34;</span><span class=o>,</span><span class=s>&#34;pixel271&#34;</span><span class=o>,</span><span class=s>&#34;pixel272&#34;</span><span class=o>,</span><span class=s>&#34;pixel273&#34;</span><span class=o>,</span><span class=s>&#34;pixel274&#34;</span><span class=o>,</span><span class=s>&#34;pixel275&#34;</span><span class=o>,</span><span class=s>&#34;pixel276&#34;</span><span class=o>,</span><span class=s>&#34;pixel277&#34;</span><span class=o>,</span><span class=s>&#34;pixel278&#34;</span><span class=o>,</span><span class=s>&#34;pixel279&#34;</span><span class=o>,</span><span class=s>&#34;pixel280&#34;</span><span class=o>,</span><span class=s>&#34;pixel281&#34;</span><span class=o>,</span><span class=s>&#34;pixel282&#34;</span><span class=o>,</span><span class=s>&#34;pixel283&#34;</span><span class=o>,</span><span class=s>&#34;pixel284&#34;</span><span class=o>,</span><span class=s>&#34;pixel285&#34;</span><span class=o>,</span><span class=s>&#34;pixel286&#34;</span><span class=o>,</span><span class=s>&#34;pixel287&#34;</span><span class=o>,</span><span class=s>&#34;pixel288&#34;</span><span class=o>,</span><span class=s>&#34;pixel289&#34;</span><span class=o>,</span><span class=s>&#34;pixel290&#34;</span><span class=o>,</span><span class=s>&#34;pixel291&#34;</span><span class=o>,</span><span class=s>&#34;pixel292&#34;</span><span class=o>,</span><span class=s>&#34;pixel293&#34;</span><span class=o>,</span><span class=s>&#34;pixel294&#34;</span><span class=o>,</span><span class=s>&#34;pixel295&#34;</span><span class=o>,</span><span class=s>&#34;pixel296&#34;</span><span class=o>,</span><span class=s>&#34;pixel297&#34;</span><span class=o>,</span><span class=s>&#34;pixel298&#34;</span><span class=o>,</span><span class=s>&#34;pixel299&#34;</span><span class=o>,</span><span class=s>&#34;pixel300&#34;</span><span class=o>,</span><span class=s>&#34;pixel301&#34;</span><span class=o>,</span><span class=s>&#34;pixel302&#34;</span><span class=o>,</span><span class=s>&#34;pixel303&#34;</span><span class=o>,</span><span class=s>&#34;pixel304&#34;</span><span class=o>,</span><span class=s>&#34;pixel305&#34;</span><span class=o>,</span><span class=s>&#34;pixel306&#34;</span><span class=o>,</span><span class=s>&#34;pixel307&#34;</span><span class=o>,</span><span class=s>&#34;pixel308&#34;</span><span class=o>,</span><span class=s>&#34;pixel309&#34;</span><span class=o>,</span><span class=s>&#34;pixel310&#34;</span><span class=o>,</span><span class=s>&#34;pixel311&#34;</span><span class=o>,</span><span class=s>&#34;pixel312&#34;</span><span class=o>,</span><span class=s>&#34;pixel313&#34;</span><span class=o>,</span><span class=s>&#34;pixel314&#34;</span><span class=o>,</span><span class=s>&#34;pixel315&#34;</span><span class=o>,</span><span class=s>&#34;pixel316&#34;</span><span class=o>,</span><span class=s>&#34;pixel317&#34;</span><span class=o>,</span><span class=s>&#34;pixel318&#34;</span><span class=o>,</span><span class=s>&#34;pixel319&#34;</span><span class=o>,</span><span class=s>&#34;pixel320&#34;</span><span class=o>,</span><span class=s>&#34;pixel321&#34;</span><span class=o>,</span><span class=s>&#34;pixel322&#34;</span><span class=o>,</span><span class=s>&#34;pixel323&#34;</span><span class=o>,</span><span class=s>&#34;pixel324&#34;</span><span class=o>,</span><span class=s>&#34;pixel325&#34;</span><span class=o>,</span><span class=s>&#34;pixel326&#34;</span><span class=o>,</span><span class=s>&#34;pixel327&#34;</span><span class=o>,</span><span class=s>&#34;pixel328&#34;</span><span class=o>,</span><span class=s>&#34;pixel329&#34;</span><span class=o>,</span><span class=s>&#34;pixel330&#34;</span><span class=o>,</span><span class=s>&#34;pixel331&#34;</span><span class=o>,</span><span class=s>&#34;pixel332&#34;</span><span class=o>,</span><span class=s>&#34;pixel333&#34;</span><span class=o>,</span><span class=s>&#34;pixel334&#34;</span><span class=o>,</span><span class=s>&#34;pixel335&#34;</span><span class=o>,</span><span class=s>&#34;pixel336&#34;</span><span class=o>,</span><span class=s>&#34;pixel337&#34;</span><span class=o>,</span><span class=s>&#34;pixel338&#34;</span><span class=o>,</span><span class=s>&#34;pixel339&#34;</span><span class=o>,</span><span class=s>&#34;pixel340&#34;</span><span class=o>,</span><span class=s>&#34;pixel341&#34;</span><span class=o>,</span><span class=s>&#34;pixel342&#34;</span><span class=o>,</span><span class=s>&#34;pixel343&#34;</span><span class=o>,</span><span class=s>&#34;pixel344&#34;</span><span class=o>,</span><span class=s>&#34;pixel345&#34;</span><span class=o>,</span><span class=s>&#34;pixel346&#34;</span><span class=o>,</span><span class=s>&#34;pixel347&#34;</span><span class=o>,</span><span class=s>&#34;pixel348&#34;</span><span class=o>,</span><span class=s>&#34;pixel349&#34;</span><span class=o>,</span><span class=s>&#34;pixel350&#34;</span><span class=o>,</span><span class=s>&#34;pixel351&#34;</span><span class=o>,</span><span class=s>&#34;pixel352&#34;</span><span class=o>,</span><span class=s>&#34;pixel353&#34;</span><span class=o>,</span><span class=s>&#34;pixel354&#34;</span><span class=o>,</span><span class=s>&#34;pixel355&#34;</span><span class=o>,</span><span class=s>&#34;pixel356&#34;</span><span class=o>,</span><span class=s>&#34;pixel357&#34;</span><span class=o>,</span><span class=s>&#34;pixel358&#34;</span><span class=o>,</span><span class=s>&#34;pixel359&#34;</span><span class=o>,</span><span class=s>&#34;pixel360&#34;</span><span class=o>,</span><span class=s>&#34;pixel361&#34;</span><span class=o>,</span><span class=s>&#34;pixel362&#34;</span><span class=o>,</span><span class=s>&#34;pixel363&#34;</span><span class=o>,</span><span class=s>&#34;pixel364&#34;</span><span class=o>,</span><span class=s>&#34;pixel365&#34;</span><span class=o>,</span><span class=s>&#34;pixel366&#34;</span><span class=o>,</span><span class=s>&#34;pixel367&#34;</span><span class=o>,</span><span class=s>&#34;pixel368&#34;</span><span class=o>,</span><span class=s>&#34;pixel369&#34;</span><span class=o>,</span><span class=s>&#34;pixel370&#34;</span><span class=o>,</span><span class=s>&#34;pixel371&#34;</span><span class=o>,</span><span class=s>&#34;pixel372&#34;</span><span class=o>,</span><span class=s>&#34;pixel373&#34;</span><span class=o>,</span><span class=s>&#34;pixel374&#34;</span><span class=o>,</span><span class=s>&#34;pixel375&#34;</span><span class=o>,</span><span class=s>&#34;pixel376&#34;</span><span class=o>,</span><span class=s>&#34;pixel377&#34;</span><span class=o>,</span><span class=s>&#34;pixel378&#34;</span><span class=o>,</span><span class=s>&#34;pixel379&#34;</span><span class=o>,</span><span class=s>&#34;pixel380&#34;</span><span class=o>,</span><span class=s>&#34;pixel381&#34;</span><span class=o>,</span><span class=s>&#34;pixel382&#34;</span><span class=o>,</span><span class=s>&#34;pixel383&#34;</span><span class=o>,</span><span class=s>&#34;pixel384&#34;</span><span class=o>,</span><span class=s>&#34;pixel385&#34;</span><span class=o>,</span><span class=s>&#34;pixel386&#34;</span><span class=o>,</span><span class=s>&#34;pixel387&#34;</span><span class=o>,</span><span class=s>&#34;pixel388&#34;</span><span class=o>,</span><span class=s>&#34;pixel389&#34;</span><span class=o>,</span><span class=s>&#34;pixel390&#34;</span><span class=o>,</span><span class=s>&#34;pixel391&#34;</span><span class=o>,</span><span class=s>&#34;pixel392&#34;</span><span class=o>,</span><span class=s>&#34;pixel393&#34;</span><span class=o>,</span><span class=s>&#34;pixel394&#34;</span><span class=o>,</span><span class=s>&#34;pixel395&#34;</span><span class=o>,</span><span class=s>&#34;pixel396&#34;</span><span class=o>,</span><span class=s>&#34;pixel397&#34;</span><span class=o>,</span><span class=s>&#34;pixel398&#34;</span><span class=o>,</span><span class=s>&#34;pixel399&#34;</span><span class=o>,</span><span class=s>&#34;pixel400&#34;</span><span class=o>,</span><span class=s>&#34;pixel401&#34;</span><span class=o>,</span><span class=s>&#34;pixel402&#34;</span><span class=o>,</span><span class=s>&#34;pixel403&#34;</span><span class=o>,</span><span class=s>&#34;pixel404&#34;</span><span class=o>,</span><span class=s>&#34;pixel405&#34;</span><span class=o>,</span><span class=s>&#34;pixel406&#34;</span><span class=o>,</span><span class=s>&#34;pixel407&#34;</span><span class=o>,</span><span class=s>&#34;pixel408&#34;</span><span class=o>,</span><span class=s>&#34;pixel409&#34;</span><span class=o>,</span><span class=s>&#34;pixel410&#34;</span><span class=o>,</span><span class=s>&#34;pixel411&#34;</span><span class=o>,</span><span class=s>&#34;pixel412&#34;</span><span class=o>,</span><span class=s>&#34;pixel413&#34;</span><span class=o>,</span><span class=s>&#34;pixel414&#34;</span><span class=o>,</span><span class=s>&#34;pixel415&#34;</span><span class=o>,</span><span class=s>&#34;pixel416&#34;</span><span class=o>,</span><span class=s>&#34;pixel417&#34;</span><span class=o>,</span><span class=s>&#34;pixel418&#34;</span><span class=o>,</span><span class=s>&#34;pixel419&#34;</span><span class=o>,</span><span class=s>&#34;pixel420&#34;</span><span class=o>,</span><span class=s>&#34;pixel421&#34;</span><span class=o>,</span><span class=s>&#34;pixel422&#34;</span><span class=o>,</span><span class=s>&#34;pixel423&#34;</span><span class=o>,</span><span class=s>&#34;pixel424&#34;</span><span class=o>,</span><span class=s>&#34;pixel425&#34;</span><span class=o>,</span><span class=s>&#34;pixel426&#34;</span><span class=o>,</span><span class=s>&#34;pixel427&#34;</span><span class=o>,</span><span class=s>&#34;pixel428&#34;</span><span class=o>,</span><span class=s>&#34;pixel429&#34;</span><span class=o>,</span><span class=s>&#34;pixel430&#34;</span><span class=o>,</span><span class=s>&#34;pixel431&#34;</span><span class=o>,</span><span class=s>&#34;pixel432&#34;</span><span class=o>,</span><span class=s>&#34;pixel433&#34;</span><span class=o>,</span><span class=s>&#34;pixel434&#34;</span><span class=o>,</span><span class=s>&#34;pixel435&#34;</span><span class=o>,</span><span class=s>&#34;pixel436&#34;</span><span class=o>,</span><span class=s>&#34;pixel437&#34;</span><span class=o>,</span><span class=s>&#34;pixel438&#34;</span><span class=o>,</span><span class=s>&#34;pixel439&#34;</span><span class=o>,</span><span class=s>&#34;pixel440&#34;</span><span class=o>,</span><span class=s>&#34;pixel441&#34;</span><span class=o>,</span><span class=s>&#34;pixel442&#34;</span><span class=o>,</span><span class=s>&#34;pixel443&#34;</span><span class=o>,</span><span class=s>&#34;pixel444&#34;</span><span class=o>,</span><span class=s>&#34;pixel445&#34;</span><span class=o>,</span><span class=s>&#34;pixel446&#34;</span><span class=o>,</span><span class=s>&#34;pixel447&#34;</span><span class=o>,</span><span class=s>&#34;pixel448&#34;</span><span class=o>,</span><span class=s>&#34;pixel449&#34;</span><span class=o>,</span><span class=s>&#34;pixel450&#34;</span><span class=o>,</span><span class=s>&#34;pixel451&#34;</span><span class=o>,</span><span class=s>&#34;pixel452&#34;</span><span class=o>,</span><span class=s>&#34;pixel453&#34;</span><span class=o>,</span><span class=s>&#34;pixel454&#34;</span><span class=o>,</span><span class=s>&#34;pixel455&#34;</span><span class=o>,</span><span class=s>&#34;pixel456&#34;</span><span class=o>,</span><span class=s>&#34;pixel457&#34;</span><span class=o>,</span><span class=s>&#34;pixel458&#34;</span><span class=o>,</span><span class=s>&#34;pixel459&#34;</span><span class=o>,</span><span class=s>&#34;pixel460&#34;</span><span class=o>,</span><span class=s>&#34;pixel461&#34;</span><span class=o>,</span><span class=s>&#34;pixel462&#34;</span><span class=o>,</span><span class=s>&#34;pixel463&#34;</span><span class=o>,</span><span class=s>&#34;pixel464&#34;</span><span class=o>,</span><span class=s>&#34;pixel465&#34;</span><span class=o>,</span><span class=s>&#34;pixel466&#34;</span><span class=o>,</span><span class=s>&#34;pixel467&#34;</span><span class=o>,</span><span class=s>&#34;pixel468&#34;</span><span class=o>,</span><span class=s>&#34;pixel469&#34;</span><span class=o>,</span><span class=s>&#34;pixel470&#34;</span><span class=o>,</span><span class=s>&#34;pixel471&#34;</span><span class=o>,</span><span class=s>&#34;pixel472&#34;</span><span class=o>,</span><span class=s>&#34;pixel473&#34;</span><span class=o>,</span><span class=s>&#34;pixel474&#34;</span><span class=o>,</span><span class=s>&#34;pixel475&#34;</span><span class=o>,</span><span class=s>&#34;pixel476&#34;</span><span class=o>,</span><span class=s>&#34;pixel477&#34;</span><span class=o>,</span><span class=s>&#34;pixel478&#34;</span><span class=o>,</span><span class=s>&#34;pixel479&#34;</span><span class=o>,</span><span class=s>&#34;pixel480&#34;</span><span class=o>,</span><span class=s>&#34;pixel481&#34;</span><span class=o>,</span><span class=s>&#34;pixel482&#34;</span><span class=o>,</span><span class=s>&#34;pixel483&#34;</span><span class=o>,</span><span class=s>&#34;pixel484&#34;</span><span class=o>,</span><span class=s>&#34;pixel485&#34;</span><span class=o>,</span><span class=s>&#34;pixel486&#34;</span><span class=o>,</span><span class=s>&#34;pixel487&#34;</span><span class=o>,</span><span class=s>&#34;pixel488&#34;</span><span class=o>,</span><span class=s>&#34;pixel489&#34;</span><span class=o>,</span><span class=s>&#34;pixel490&#34;</span><span class=o>,</span><span class=s>&#34;pixel491&#34;</span><span class=o>,</span><span class=s>&#34;pixel492&#34;</span><span class=o>,</span><span class=s>&#34;pixel493&#34;</span><span class=o>,</span><span class=s>&#34;pixel494&#34;</span><span class=o>,</span><span class=s>&#34;pixel495&#34;</span><span class=o>,</span><span class=s>&#34;pixel496&#34;</span><span class=o>,</span><span class=s>&#34;pixel497&#34;</span><span class=o>,</span><span class=s>&#34;pixel498&#34;</span><span class=o>,</span><span class=s>&#34;pixel499&#34;</span><span class=o>,</span><span class=s>&#34;pixel500&#34;</span><span class=o>,</span><span class=s>&#34;pixel501&#34;</span><span class=o>,</span><span class=s>&#34;pixel502&#34;</span><span class=o>,</span><span class=s>&#34;pixel503&#34;</span><span class=o>,</span><span class=s>&#34;pixel504&#34;</span><span class=o>,</span><span class=s>&#34;pixel505&#34;</span><span class=o>,</span><span class=s>&#34;pixel506&#34;</span><span class=o>,</span><span class=s>&#34;pixel507&#34;</span><span class=o>,</span><span class=s>&#34;pixel508&#34;</span><span class=o>,</span><span class=s>&#34;pixel509&#34;</span><span class=o>,</span><span class=s>&#34;pixel510&#34;</span><span class=o>,</span><span class=s>&#34;pixel511&#34;</span><span class=o>,</span><span class=s>&#34;pixel512&#34;</span><span class=o>,</span><span class=s>&#34;pixel513&#34;</span><span class=o>,</span><span class=s>&#34;pixel514&#34;</span><span class=o>,</span><span class=s>&#34;pixel515&#34;</span><span class=o>,</span><span class=s>&#34;pixel516&#34;</span><span class=o>,</span><span class=s>&#34;pixel517&#34;</span><span class=o>,</span><span class=s>&#34;pixel518&#34;</span><span class=o>,</span><span class=s>&#34;pixel519&#34;</span><span class=o>,</span><span class=s>&#34;pixel520&#34;</span><span class=o>,</span><span class=s>&#34;pixel521&#34;</span><span class=o>,</span><span class=s>&#34;pixel522&#34;</span><span class=o>,</span><span class=s>&#34;pixel523&#34;</span><span class=o>,</span><span class=s>&#34;pixel524&#34;</span><span class=o>,</span><span class=s>&#34;pixel525&#34;</span><span class=o>,</span><span class=s>&#34;pixel526&#34;</span><span class=o>,</span><span class=s>&#34;pixel527&#34;</span><span class=o>,</span><span class=s>&#34;pixel528&#34;</span><span class=o>,</span><span class=s>&#34;pixel529&#34;</span><span class=o>,</span><span class=s>&#34;pixel530&#34;</span><span class=o>,</span><span class=s>&#34;pixel531&#34;</span><span class=o>,</span><span class=s>&#34;pixel532&#34;</span><span class=o>,</span><span class=s>&#34;pixel533&#34;</span><span class=o>,</span><span class=s>&#34;pixel534&#34;</span><span class=o>,</span><span class=s>&#34;pixel535&#34;</span><span class=o>,</span><span class=s>&#34;pixel536&#34;</span><span class=o>,</span><span class=s>&#34;pixel537&#34;</span><span class=o>,</span><span class=s>&#34;pixel538&#34;</span><span class=o>,</span><span class=s>&#34;pixel539&#34;</span><span class=o>,</span><span class=s>&#34;pixel540&#34;</span><span class=o>,</span><span class=s>&#34;pixel541&#34;</span><span class=o>,</span><span class=s>&#34;pixel542&#34;</span><span class=o>,</span><span class=s>&#34;pixel543&#34;</span><span class=o>,</span><span class=s>&#34;pixel544&#34;</span><span class=o>,</span><span class=s>&#34;pixel545&#34;</span><span class=o>,</span><span class=s>&#34;pixel546&#34;</span><span class=o>,</span><span class=s>&#34;pixel547&#34;</span><span class=o>,</span><span class=s>&#34;pixel548&#34;</span><span class=o>,</span><span class=s>&#34;pixel549&#34;</span><span class=o>,</span><span class=s>&#34;pixel550&#34;</span><span class=o>,</span><span class=s>&#34;pixel551&#34;</span><span class=o>,</span><span class=s>&#34;pixel552&#34;</span><span class=o>,</span><span class=s>&#34;pixel553&#34;</span><span class=o>,</span><span class=s>&#34;pixel554&#34;</span><span class=o>,</span><span class=s>&#34;pixel555&#34;</span><span class=o>,</span><span class=s>&#34;pixel556&#34;</span><span class=o>,</span><span class=s>&#34;pixel557&#34;</span><span class=o>,</span><span class=s>&#34;pixel558&#34;</span><span class=o>,</span><span class=s>&#34;pixel559&#34;</span><span class=o>,</span><span class=s>&#34;pixel560&#34;</span><span class=o>,</span><span class=s>&#34;pixel561&#34;</span><span class=o>,</span><span class=s>&#34;pixel562&#34;</span><span class=o>,</span><span class=s>&#34;pixel563&#34;</span><span class=o>,</span><span class=s>&#34;pixel564&#34;</span><span class=o>,</span><span class=s>&#34;pixel565&#34;</span><span class=o>,</span><span class=s>&#34;pixel566&#34;</span><span class=o>,</span><span class=s>&#34;pixel567&#34;</span><span class=o>,</span><span class=s>&#34;pixel568&#34;</span><span class=o>,</span><span class=s>&#34;pixel569&#34;</span><span class=o>,</span><span class=s>&#34;pixel570&#34;</span><span class=o>,</span><span class=s>&#34;pixel571&#34;</span><span class=o>,</span><span class=s>&#34;pixel572&#34;</span><span class=o>,</span><span class=s>&#34;pixel573&#34;</span><span class=o>,</span><span class=s>&#34;pixel574&#34;</span><span class=o>,</span><span class=s>&#34;pixel575&#34;</span><span class=o>,</span><span class=s>&#34;pixel576&#34;</span><span class=o>,</span><span class=s>&#34;pixel577&#34;</span><span class=o>,</span><span class=s>&#34;pixel578&#34;</span><span class=o>,</span><span class=s>&#34;pixel579&#34;</span><span class=o>,</span><span class=s>&#34;pixel580&#34;</span><span class=o>,</span><span class=s>&#34;pixel581&#34;</span><span class=o>,</span><span class=s>&#34;pixel582&#34;</span><span class=o>,</span><span class=s>&#34;pixel583&#34;</span><span class=o>,</span><span class=s>&#34;pixel584&#34;</span><span class=o>,</span><span class=s>&#34;pixel585&#34;</span><span class=o>,</span><span class=s>&#34;pixel586&#34;</span><span class=o>,</span><span class=s>&#34;pixel587&#34;</span><span class=o>,</span><span class=s>&#34;pixel588&#34;</span><span class=o>,</span><span class=s>&#34;pixel589&#34;</span><span class=o>,</span><span class=s>&#34;pixel590&#34;</span><span class=o>,</span><span class=s>&#34;pixel591&#34;</span><span class=o>,</span><span class=s>&#34;pixel592&#34;</span><span class=o>,</span><span class=s>&#34;pixel593&#34;</span><span class=o>,</span><span class=s>&#34;pixel594&#34;</span><span class=o>,</span><span class=s>&#34;pixel595&#34;</span><span class=o>,</span><span class=s>&#34;pixel596&#34;</span><span class=o>,</span><span class=s>&#34;pixel597&#34;</span><span class=o>,</span><span class=s>&#34;pixel598&#34;</span><span class=o>,</span><span class=s>&#34;pixel599&#34;</span><span class=o>,</span><span class=s>&#34;pixel600&#34;</span><span class=o>,</span><span class=s>&#34;pixel601&#34;</span><span class=o>,</span><span class=s>&#34;pixel602&#34;</span><span class=o>,</span><span class=s>&#34;pixel603&#34;</span><span class=o>,</span><span class=s>&#34;pixel604&#34;</span><span class=o>,</span><span class=s>&#34;pixel605&#34;</span><span class=o>,</span><span class=s>&#34;pixel606&#34;</span><span class=o>,</span><span class=s>&#34;pixel607&#34;</span><span class=o>,</span><span class=s>&#34;pixel608&#34;</span><span class=o>,</span><span class=s>&#34;pixel609&#34;</span><span class=o>,</span><span class=s>&#34;pixel610&#34;</span><span class=o>,</span><span class=s>&#34;pixel611&#34;</span><span class=o>,</span><span class=s>&#34;pixel612&#34;</span><span class=o>,</span><span class=s>&#34;pixel613&#34;</span><span class=o>,</span><span class=s>&#34;pixel614&#34;</span><span class=o>,</span><span class=s>&#34;pixel615&#34;</span><span class=o>,</span><span class=s>&#34;pixel616&#34;</span><span class=o>,</span><span class=s>&#34;pixel617&#34;</span><span class=o>,</span><span class=s>&#34;pixel618&#34;</span><span class=o>,</span><span class=s>&#34;pixel619&#34;</span><span class=o>,</span><span class=s>&#34;pixel620&#34;</span><span class=o>,</span><span class=s>&#34;pixel621&#34;</span><span class=o>,</span><span class=s>&#34;pixel622&#34;</span><span class=o>,</span><span class=s>&#34;pixel623&#34;</span><span class=o>,</span><span class=s>&#34;pixel624&#34;</span><span class=o>,</span><span class=s>&#34;pixel625&#34;</span><span class=o>,</span><span class=s>&#34;pixel626&#34;</span><span class=o>,</span><span class=s>&#34;pixel627&#34;</span><span class=o>,</span><span class=s>&#34;pixel628&#34;</span><span class=o>,</span><span class=s>&#34;pixel629&#34;</span><span class=o>,</span><span class=s>&#34;pixel630&#34;</span><span class=o>,</span><span class=s>&#34;pixel631&#34;</span><span class=o>,</span><span class=s>&#34;pixel632&#34;</span><span class=o>,</span><span class=s>&#34;pixel633&#34;</span><span class=o>,</span><span class=s>&#34;pixel634&#34;</span><span class=o>,</span><span class=s>&#34;pixel635&#34;</span><span class=o>,</span><span class=s>&#34;pixel636&#34;</span><span class=o>,</span><span class=s>&#34;pixel637&#34;</span><span class=o>,</span><span class=s>&#34;pixel638&#34;</span><span class=o>,</span><span class=s>&#34;pixel639&#34;</span><span class=o>,</span><span class=s>&#34;pixel640&#34;</span><span class=o>,</span><span class=s>&#34;pixel641&#34;</span><span class=o>,</span><span class=s>&#34;pixel642&#34;</span><span class=o>,</span><span class=s>&#34;pixel643&#34;</span><span class=o>,</span><span class=s>&#34;pixel644&#34;</span><span class=o>,</span><span class=s>&#34;pixel645&#34;</span><span class=o>,</span><span class=s>&#34;pixel646&#34;</span><span class=o>,</span><span class=s>&#34;pixel647&#34;</span><span class=o>,</span><span class=s>&#34;pixel648&#34;</span><span class=o>,</span><span class=s>&#34;pixel649&#34;</span><span class=o>,</span><span class=s>&#34;pixel650&#34;</span><span class=o>,</span><span class=s>&#34;pixel651&#34;</span><span class=o>,</span><span class=s>&#34;pixel652&#34;</span><span class=o>,</span><span class=s>&#34;pixel653&#34;</span><span class=o>,</span><span class=s>&#34;pixel654&#34;</span><span class=o>,</span><span class=s>&#34;pixel655&#34;</span><span class=o>,</span><span class=s>&#34;pixel656&#34;</span><span class=o>,</span><span class=s>&#34;pixel657&#34;</span><span class=o>,</span><span class=s>&#34;pixel658&#34;</span><span class=o>,</span><span class=s>&#34;pixel659&#34;</span><span class=o>,</span><span class=s>&#34;pixel660&#34;</span><span class=o>,</span><span class=s>&#34;pixel661&#34;</span><span class=o>,</span><span class=s>&#34;pixel662&#34;</span><span class=o>,</span><span class=s>&#34;pixel663&#34;</span><span class=o>,</span><span class=s>&#34;pixel664&#34;</span><span class=o>,</span><span class=s>&#34;pixel665&#34;</span><span class=o>,</span><span class=s>&#34;pixel666&#34;</span><span class=o>,</span><span class=s>&#34;pixel667&#34;</span><span class=o>,</span><span class=s>&#34;pixel668&#34;</span><span class=o>,</span><span class=s>&#34;pixel669&#34;</span><span class=o>,</span><span class=s>&#34;pixel670&#34;</span><span class=o>,</span><span class=s>&#34;pixel671&#34;</span><span class=o>,</span><span class=s>&#34;pixel672&#34;</span><span class=o>,</span><span class=s>&#34;pixel673&#34;</span><span class=o>,</span><span class=s>&#34;pixel674&#34;</span><span class=o>,</span><span class=s>&#34;pixel675&#34;</span><span class=o>,</span><span class=s>&#34;pixel676&#34;</span><span class=o>,</span><span class=s>&#34;pixel677&#34;</span><span class=o>,</span><span class=s>&#34;pixel678&#34;</span><span class=o>,</span><span class=s>&#34;pixel679&#34;</span><span class=o>,</span><span class=s>&#34;pixel680&#34;</span><span class=o>,</span><span class=s>&#34;pixel681&#34;</span><span class=o>,</span><span class=s>&#34;pixel682&#34;</span><span class=o>,</span><span class=s>&#34;pixel683&#34;</span><span class=o>,</span><span class=s>&#34;pixel684&#34;</span><span class=o>,</span><span class=s>&#34;pixel685&#34;</span><span class=o>,</span><span class=s>&#34;pixel686&#34;</span><span class=o>,</span><span class=s>&#34;pixel687&#34;</span><span class=o>,</span><span class=s>&#34;pixel688&#34;</span><span class=o>,</span><span class=s>&#34;pixel689&#34;</span><span class=o>,</span><span class=s>&#34;pixel690&#34;</span><span class=o>,</span><span class=s>&#34;pixel691&#34;</span><span class=o>,</span><span class=s>&#34;pixel692&#34;</span><span class=o>,</span><span class=s>&#34;pixel693&#34;</span><span class=o>,</span><span class=s>&#34;pixel694&#34;</span><span class=o>,</span><span class=s>&#34;pixel695&#34;</span><span class=o>,</span><span class=s>&#34;pixel696&#34;</span><span class=o>,</span><span class=s>&#34;pixel697&#34;</span><span class=o>,</span><span class=s>&#34;pixel698&#34;</span><span class=o>,</span><span class=s>&#34;pixel699&#34;</span><span class=o>,</span><span class=s>&#34;pixel700&#34;</span><span class=o>,</span><span class=s>&#34;pixel701&#34;</span><span class=o>,</span><span class=s>&#34;pixel702&#34;</span><span class=o>,</span><span class=s>&#34;pixel703&#34;</span><span class=o>,</span><span class=s>&#34;pixel704&#34;</span><span class=o>,</span><span class=s>&#34;pixel705&#34;</span><span class=o>,</span><span class=s>&#34;pixel706&#34;</span><span class=o>,</span><span class=s>&#34;pixel707&#34;</span><span class=o>,</span><span class=s>&#34;pixel708&#34;</span><span class=o>,</span><span class=s>&#34;pixel709&#34;</span><span class=o>,</span><span class=s>&#34;pixel710&#34;</span><span class=o>,</span><span class=s>&#34;pixel711&#34;</span><span class=o>,</span><span class=s>&#34;pixel712&#34;</span><span class=o>,</span><span class=s>&#34;pixel713&#34;</span><span class=o>,</span><span class=s>&#34;pixel714&#34;</span><span class=o>,</span><span class=s>&#34;pixel715&#34;</span><span class=o>,</span><span class=s>&#34;pixel716&#34;</span><span class=o>,</span><span class=s>&#34;pixel717&#34;</span><span class=o>,</span><span class=s>&#34;pixel718&#34;</span><span class=o>,</span><span class=s>&#34;pixel719&#34;</span><span class=o>,</span><span class=s>&#34;pixel720&#34;</span><span class=o>,</span><span class=s>&#34;pixel721&#34;</span><span class=o>,</span><span class=s>&#34;pixel722&#34;</span><span class=o>,</span><span class=s>&#34;pixel723&#34;</span><span class=o>,</span><span class=s>&#34;pixel724&#34;</span><span class=o>,</span><span class=s>&#34;pixel725&#34;</span><span class=o>,</span><span class=s>&#34;pixel726&#34;</span><span class=o>,</span><span class=s>&#34;pixel727&#34;</span><span class=o>,</span><span class=s>&#34;pixel728&#34;</span><span class=o>,</span><span class=s>&#34;pixel729&#34;</span><span class=o>,</span><span class=s>&#34;pixel730&#34;</span><span class=o>,</span><span class=s>&#34;pixel731&#34;</span><span class=o>,</span><span class=s>&#34;pixel732&#34;</span><span class=o>,</span><span class=s>&#34;pixel733&#34;</span><span class=o>,</span><span class=s>&#34;pixel734&#34;</span><span class=o>,</span><span class=s>&#34;pixel735&#34;</span><span class=o>,</span><span class=s>&#34;pixel736&#34;</span><span class=o>,</span><span class=s>&#34;pixel737&#34;</span><span class=o>,</span><span class=s>&#34;pixel738&#34;</span><span class=o>,</span><span class=s>&#34;pixel739&#34;</span><span class=o>,</span><span class=s>&#34;pixel740&#34;</span><span class=o>,</span><span class=s>&#34;pixel741&#34;</span><span class=o>,</span><span class=s>&#34;pixel742&#34;</span><span class=o>,</span><span class=s>&#34;pixel743&#34;</span><span class=o>,</span><span class=s>&#34;pixel744&#34;</span><span class=o>,</span><span class=s>&#34;pixel745&#34;</span><span class=o>,</span><span class=s>&#34;pixel746&#34;</span><span class=o>,</span><span class=s>&#34;pixel747&#34;</span><span class=o>,</span><span class=s>&#34;pixel748&#34;</span><span class=o>,</span><span class=s>&#34;pixel749&#34;</span><span class=o>,</span><span class=s>&#34;pixel750&#34;</span><span class=o>,</span><span class=s>&#34;pixel751&#34;</span><span class=o>,</span><span class=s>&#34;pixel752&#34;</span><span class=o>,</span><span class=s>&#34;pixel753&#34;</span><span class=o>,</span><span class=s>&#34;pixel754&#34;</span><span class=o>,</span><span class=s>&#34;pixel755&#34;</span><span class=o>,</span><span class=s>&#34;pixel756&#34;</span><span class=o>,</span><span class=s>&#34;pixel757&#34;</span><span class=o>,</span><span class=s>&#34;pixel758&#34;</span><span class=o>,</span><span class=s>&#34;pixel759&#34;</span><span class=o>,</span><span class=s>&#34;pixel760&#34;</span><span class=o>,</span><span class=s>&#34;pixel761&#34;</span><span class=o>,</span><span class=s>&#34;pixel762&#34;</span><span class=o>,</span><span class=s>&#34;pixel763&#34;</span><span class=o>,</span><span class=s>&#34;pixel764&#34;</span><span class=o>,</span><span class=s>&#34;pixel765&#34;</span><span class=o>,</span><span class=s>&#34;pixel766&#34;</span><span class=o>,</span><span class=s>&#34;pixel767&#34;</span><span class=o>,</span><span class=s>&#34;pixel768&#34;</span><span class=o>,</span><span class=s>&#34;pixel769&#34;</span><span class=o>,</span><span class=s>&#34;pixel770&#34;</span><span class=o>,</span><span class=s>&#34;pixel771&#34;</span><span class=o>,</span><span class=s>&#34;pixel772&#34;</span><span class=o>,</span><span class=s>&#34;pixel773&#34;</span><span class=o>,</span><span class=s>&#34;pixel774&#34;</span><span class=o>,</span><span class=s>&#34;pixel775&#34;</span><span class=o>,</span><span class=s>&#34;pixel776&#34;</span><span class=o>,</span><span class=s>&#34;pixel777&#34;</span><span class=o>,</span><span class=s>&#34;pixel778&#34;</span><span class=o>,</span><span class=s>&#34;pixel779&#34;</span><span class=o>,</span><span class=s>&#34;pixel780&#34;</span><span class=o>,</span><span class=s>&#34;pixel781&#34;</span><span class=o>,</span><span class=s>&#34;pixel782&#34;</span><span class=o>,</span><span class=s>&#34;pixel783&#34;</span><span class=o>)</span>

<span class=k>val</span> <span class=n>assembler</span> <span class=k>=</span> <span class=o>{</span> <span class=k>new</span> <span class=nc>VectorAssembler</span><span class=o>()</span>
  <span class=o>.</span><span class=n>setInputCols</span><span class=o>(</span><span class=n>features</span><span class=o>)</span>
<span class=o>}</span>

<span class=k>val</span> <span class=n>trainDF</span> <span class=k>=</span> <span class=n>assembler</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>train</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=n>label</span><span class=o>,</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>
<span class=k>val</span> <span class=n>testDF</span> <span class=k>=</span> <span class=n>assembler</span><span class=o>.</span><span class=n>transform</span><span class=o>(</span><span class=n>test</span><span class=o>).</span><span class=n>select</span><span class=o>(</span><span class=n>label</span><span class=o>,</span><span class=n>assembler</span><span class=o>.</span><span class=n>getOutputCol</span><span class=o>)</span>

<span class=k>val</span> <span class=n>trainH2O</span><span class=k>:</span> <span class=kt>H2OFrame</span> <span class=o>=</span> <span class=n>h2oContext</span><span class=o>.</span><span class=n>asH2OFrame</span><span class=o>(</span><span class=n>trainDF</span><span class=o>,</span> <span class=nc>Some</span><span class=o>(</span><span class=s>&#34;trainH2O&#34;</span><span class=o>))</span>
<span class=k>val</span> <span class=n>testH2O</span><span class=k>:</span> <span class=kt>H2OFrame</span> <span class=o>=</span> <span class=n>h2oContext</span><span class=o>.</span><span class=n>asH2OFrame</span><span class=o>(</span><span class=n>testDF</span><span class=o>,</span> <span class=nc>Some</span><span class=o>(</span><span class=s>&#34;testH2O&#34;</span><span class=o>))</span>

<span class=n>trainH2O</span><span class=o>.</span><span class=n>replace</span><span class=o>(</span><span class=n>trainH2O</span><span class=o>.</span><span class=n>find</span><span class=o>(</span><span class=s>&#34;label&#34;</span><span class=o>),</span> <span class=n>trainH2O</span><span class=o>.</span><span class=n>vec</span><span class=o>(</span><span class=s>&#34;label&#34;</span><span class=o>).</span><span class=n>toCategoricalVec</span><span class=o>).</span><span class=n>remove</span><span class=o>()</span>
<span class=n>testH2O</span><span class=o>.</span><span class=n>replace</span><span class=o>(</span><span class=n>testH2O</span><span class=o>.</span><span class=n>find</span><span class=o>(</span><span class=s>&#34;label&#34;</span><span class=o>),</span> <span class=n>testH2O</span><span class=o>.</span><span class=n>vec</span><span class=o>(</span><span class=s>&#34;label&#34;</span><span class=o>).</span><span class=n>toCategoricalVec</span><span class=o>).</span><span class=n>remove</span><span class=o>()</span>

<span class=n>trainH2O</span><span class=o>.</span><span class=n>update</span><span class=o>(</span><span class=kc>null</span><span class=o>)</span>
<span class=n>testH2O</span><span class=o>.</span><span class=n>update</span><span class=o>(</span><span class=kc>null</span><span class=o>)</span>

<span class=c1>// Set the Deep Learning Parameters
</span><span class=c1></span><span class=k>val</span> <span class=n>dlParams</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>DeepLearningParameters</span><span class=o>()</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_model_id</span> <span class=k>=</span> <span class=nc>Key</span><span class=o>.</span><span class=n>make</span><span class=o>(</span><span class=s>&#34;dlModel.hex&#34;</span><span class=o>)</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_train</span> <span class=k>=</span> <span class=n>trainH2O</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_valid</span> <span class=k>=</span> <span class=n>testH2O</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_response_column</span> <span class=k>=</span> <span class=s>&#34;label&#34;</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_loss</span> <span class=k>=</span> <span class=nc>Loss</span><span class=o>.</span><span class=nc>CrossEntropy</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_activation</span> <span class=k>=</span> <span class=nc>Activation</span><span class=o>.</span><span class=nc>RectifierWithDropout</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_train_samples_per_iteration</span> <span class=k>=</span> <span class=o>-</span><span class=mi>1</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_epochs</span> <span class=k>=</span> <span class=mi>8000</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_l1</span> <span class=k>=</span> <span class=mi>1</span><span class=n>e</span><span class=o>-</span><span class=mi>7</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_input_dropout_ratio</span> <span class=k>=</span> <span class=mf>0.2</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_classification_stop</span> <span class=k>=</span> <span class=o>-</span><span class=mi>1</span>
<span class=n>dlParams</span><span class=o>.</span><span class=nc>_hidden</span> <span class=k>=</span> <span class=nc>Array</span><span class=o>[</span><span class=kt>Int</span><span class=o>](</span><span class=mi>784</span><span class=o>,</span><span class=mi>800</span><span class=o>)</span>

<span class=c1>// Create a job
</span><span class=c1></span><span class=k>val</span> <span class=n>dl</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>DeepLearning</span><span class=o>(</span><span class=n>dlParams</span><span class=o>)</span>
<span class=k>val</span> <span class=n>dlModel</span> <span class=k>=</span> <span class=n>dl</span><span class=o>.</span><span class=n>trainModel</span><span class=o>.</span><span class=n>get</span>

<span class=c1>// Compute metrics on both datasets
</span><span class=c1></span><span class=n>dlModel</span><span class=o>.</span><span class=n>score</span><span class=o>(</span><span class=n>testH2O</span><span class=o>).</span><span class=n>delete</span></code></pre></div><h3 id=8-0-next-steps>8.0 Next Steps</h3><p>So where to from here? I think I will look at further feature engineering similar to the Wikipedia blog where the authors are performing &lsquo;elastic distortions&rsquo; but that will be in a follow up post.</p></div><div id=source>If you find an error please raise a <a class="basic-alignment left" href=https://github.com/seddonm1/seddonm1.github.io/blob/main/content/posts/using-apache-spark-neural-networks-to-recognise-digits%20copy.md>pull request</a>.</div><div id=links><a class="basic-alignment left" href=https://reorchestrate.com/posts/affinetransform-transformer-for-apache-spark-ml/>&laquo; AffineTransform Transformer for Apache Spark ML</a>
<a class="basic-alignment left" href=https://reorchestrate.com/posts/code-doesnt-scale-for-etl/>Code doesn&#39;t scale for ETL &raquo;</a></div></section></body></html>